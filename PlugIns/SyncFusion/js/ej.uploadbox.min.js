/*!
*  filename: ej.uploadbox.min.js
*  version : 11.2.0.63
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n,t){t.widget("ejUploadbox","ej.Uploadbox",{element:null,model:null,_rootCSS:"e-uploadbox",defaults:{browseButtonText:"Browse",uploadButtonText:"Upload",asyncUpload:!0,disabled:!1,multipleFilesSelect:!1,autoUpload:!1,showFileDetails:!0,fileFormatAllow:"",fileFormatDeny:"",saveUrl:"",removeUrl:"",cssClass:"",rtl:!1,create:null,fileSelect:null,begin:null,cancel:null,complete:null,remove:null,error:null,destroy:null},dataTypes:{browseButtonText:"string",uploadButtonText:"string",disbled:"boolean",multipleFilesUpload:"boolean",autoUpload:"boolean",showFileDetails:"boolean",fileFormatAllow:"string",fileFormatDeny:"string",saveUrl:"string",removeUrl:"string",cssClass:"string",rtl:"boolean"},disable:function(){this.element.addClass("e-state-disabled")},enable:function(){this.element.hasClass("e-state-disabled")&&this.element.removeClass("e-state-disabled")},_init:function(){this._initialize(),this._wireEvents(),this.model.asyncUpload||this._initObjectsSyncUpload(),this.model.disabled?this.disable():this.enable()},_setModel:function(n){var t;for(t in n)switch(t){case"browseButtonText":this._setBrowseButtonText(n[t]);break;case"uploadButtonText":this._setUploadButtonText(n[t]);break;case"cssClass":this._setSkin(n[t]);break;case"rtl":this._setRTL(n[t])}},_setRTL:function(t){t?(this.element.addClass("e-rtl"),window.navigator.appName=="Microsoft Internet Explorer"&&this.inputupload.css("right","-153px")):(this.element.removeClass("e-rtl"),window.navigator.appName=="Microsoft Internet Explorer"&&this.inputupload.css("right","0px")),n("#"+this.element[0].id+"_dialog").ejDialog({rtl:t})},_setBrowseButtonText:function(n){this.buttondiv.val(n)},_setUploadButtonText:function(t){n("#"+this.control.id+" .upload-button").html(t)},_destroy:function(){this.element.hasClass("e-uploadbox")&&(this.element.removeClass("e-uploadbox"),this.element.empty())},_setSkin:function(n){this.element.removeClass(this.model.cssClass),this.element.addClass(n)},_initialize:function(){this.control=this.element[0],this.element.addClass(this.model.cssClass),this.innerdiv=t.buildTag("div.selectionpart"),this.element.append(this.innerdiv),this.buttondiv=t.buildTag("input.inputbutton#"+this.control.id+"_SelectButton","",{},{type:"button",value:this.model.browseButtonText}),this.inputupload=t.buildTag("input.e-uploadinput","",{},{type:"file",name:this.control.id}),this.model.multipleFilesSelect&&this.inputupload.attr(multiple,"multiple"),this.innerdiv.append(this.buttondiv),this.innerdiv.append(this.inputupload),this._Selector=this.element.find("#"+this.control.id+"_SelectButton")[0],this._setRTL(this.model.rtl),this.Uploadframes=[],this.UploadForms=[],this.UploadType=this._isXhrSupported()?"Xhr":"IFrame",window.navigator.vendor=="Google Inc."&&this.innerdiv.css("padding","4px 10px")},_wireEvents:function(){this._on(this.inputupload,"click",this._disableclickselect),this._bindInputChangeEvent()},_disableclickselect:function(n){this.element.hasClass("e-state-disabled")&&n.preventDefault()},_bindInputChangeEvent:function(){this._on(this.inputupload,"change",this._inputValueChange)},_inputValueChange:function(t){var i,r;i=n(t.target),n("#"+this.control.id).find(".upload-button").css("visibility","visible"),r=this._getInputFileInfo(i),this._trigger("fileSelect"),this._isAllowed(r)&&(this.model.asyncUpload?this.UploadType=="Xhr"?this._onXhrSelect(t):this._onSelectIFrame(t):this._onSelectSyncUpload(t))},__uploadButtonClick:function(t){this.UploadType=="Xhr"?this._xhrOnUploadButtonClick(t):this._onUploadButtonClickIFrame(t),n("#"+this.control.id).find(".upload-file-list").addClass("remove"),n(t.target).remove(),(window.navigator.appName=="Microsoft Internet Explorer"||window.navigator.appName=="Netscape")&&n(".selectionpart",this.control).css("float","none")},_actionClick:function(t){var r,i,u;r=n(t.target),i=r.closest(".upload-file"),u=n(i).data("file"),r.hasClass("file-action-delete")?(this._trigger("remove",{fileStatus:u}),this.UploadType=="Xhr"?this._xhrOnRemove(t,i):this._onRemoveIFrame(t,i)):r.hasClass("file-action-cancel")?(this._trigger("cancel",{fileStatus:u}),this.model.asyncUpload?this.UploadType=="Xhr"?this._xhrOnCancel(t,i):this._onCancelIFrame(t,i):this._onCancelSyncUpload(t,i)):r.hasClass("file-action-retry")&&(this.UploadType=="Xhr"?this._xhrOnRetry(t,i):this._onRetryIFrame(t,i))},_removeFileEntry:function(n){n.remove()},_isFileUpload:function(t){var i=n(t).find("div.file-action");return i.is(".file-action-cancel")},_isXhrSupported:function(){var n,i,r,t;return n=navigator.userAgent.toLowerCase(),t=0,navigator.userAgent.search("MSIE")>0&&(i=navigator.userAgent.search("MSIE")+5,r=navigator.userAgent.search("; Windows"),t=navigator.userAgent.substring(i,r)),navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0&&(n=n.substring(n.indexOf("safari/")+7),n=n.substring(0,n.indexOf(".")),t=n),navigator.userAgent.search("MSIE")>0&&t>9||navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0&&t==536?!1:typeof FormData!="undefined"&&typeof File!="undefined"},_getFileName:function(t){return n.map(this._getAllFileInfo(t),function(n){return n.name}).join(", ")},_getFileSize:function(t){var i=this;return n.map(this._getAllFileInfo(t),function(n){return i._formatSize(n.size)}).join(", ")},_pushFile:function(i,r){var f,e,o,u,s,h,c;for(filedialog=this.element.find("#"+this.element[0].id+"_dialog"),filedialog.length!=0?n("#"+this.element[0].id+"_dialog").ejDialog("open"):(this.updialog=t.buildTag("div.uploaddialog#"+this.element[0].id+"_dialog","",{},{title:"Upload Box"}),this.element.append(this.updialog)),f=n("#"+this.control.id+" .upload-file-list"),f.length==0&&(f=t.buildTag("ul.upload-file-list").appendTo(this.updialog),this.model.showFileDetails||f.hide()),h=this.element.offset().left+150,c=this.element.offset().top+50,n("#"+this.element[0].id+"_dialog").ejDialog({width:510,cssClass:this.model.cssClass,close:this._uploadFileListDelete,position:{X:h,Y:c},minHeight:110,rtl:this.model.rtl,contentContainer:"#"+this.element[0].id,resizable:!1}),u=0;u<i.length;u++)e=n("<li class='upload-file'><div class='file-list'><div class='file-progress file-view'><div class='file-name file-view'><span class='file-name-text'>"+i[u].name+"<\/span><\/div><\/div><div class='file-size file-view'><span class='file-name-text'>"+i[u].size+"<\/span><\/div><div class='file-percentage file-view'>0%<\/div><div class='action-perform'><div class='file-action file-view'><\/div><\/div><div class='file-progress-bar'><div class='file-progress-status'><\/div><\/div><\/div><\/li>").appendTo(f).data(r),(this._getFileSize(i[u]).toString().toLowerCase()=="nankb"||i[u].size==null)&&e.find(".file-size").remove(),s="cancel",e.find(".file-action").remove().addClass(s.toString()),s=="cancel"?o=t.buildTag("div.file-action file-action-cancel","",{},{title:"cancel"}):s=="remove"?o=t.buildTag("div.file-action file-action-delete","",{},{title:"remove"}):s=="retry"&&(o=t.buildTag("div.file-action file-action-retry","",{},{title:"retry"})),e.find(".action-perform").append(o),this._on(o,"click",this._actionClick);return e},_pushFileDetails:function(i){var o,r,u,f,e;return o=this,filedialog=this.element.find("#"+this.element[0].id+"_dialog"),filedialog.length!=0?n("#"+this.element[0].id+"_dialog").ejDialog("open"):(this.updialog=t.buildTag("div.uploaddialog#"+this.element[0].id+"_dialog","",{},{title:"Upload Box"}),this.element.append(this.updialog)),r=n("#"+this.control.id+" .upload-file-list"),r.length==0&&(r=t.buildTag("ul.upload-file-list").appendTo(this.updialog),this.model.showFileDetails||r.hide()),f=this.element.offset().left+150,e=this.element.offset().top+50,u=n("<li class='upload-file'><div class='file-list'><div class='file-progress file-view'><div class='file-name file-view'><span class='file-name-text'>"+i.name+"<\/span><\/div><\/div><div class='file-size file-view'><span class='file-name-text'>"+this._formatSize(0)+"\\"+this._formatSize(i.size)+"<\/span><\/div><div class='file-percentage file-view'>0%<\/div><div class='action-perform'><div class='file-action file-view'><\/div><\/div><div class='file-progress-bar'><div class='file-progress-status'><\/div><\/div><\/div><\/li>").appendTo(r).data("file",i),n("#"+this.element[0].id+"_dialog").ejDialog({width:520,cssClass:this.model.cssClass,close:this._uploadFileListDelete,position:{X:f,Y:e},minHeight:110,rtl:this.model.rtl,contentContainer:"#"+this.element[0].id,resizable:!1}),u},_setProgress:function(t,i,r){var u,f,e,o,s;u=n(t).find(".file-progress-status"),u.width(i+"%"),f=n(t).find(".file-percentage"),f.html(i+"%"),e=n(t).find(".file-size .file-name-text"),o=this._formatSize(r.loaded),s=this._formatSize(r.total),e.html(o+"\\"+s)},_setAction:function(n,i){var r;n.find(".file-action").remove().addClass(i.toString()),i=="cancel"?r=t.buildTag("div.file-action file-action-cancel","",{},{title:"cancel"}):i=="remove"?r=t.buildTag("div.file-action file-action-delete","",{},{title:"remove"}):i=="retry"&&(r=t.buildTag("div.file-action file-action-retry","",{},{title:"retry"})),n.find(".action-perform").append(r),this._on(r,"click",this._actionClick)},_setStatus:function(n,i){var u,r=t.buildTag("div");i=="success"&&(n.find(".file-status").addClass("file-status-success").html("Completed"),n.find(".file-percentage").html("").attr("title","Completed"),r.addClass("file-percentage-success"),n.find(".file-percentage").append(r)),i=="failed"&&(n.find(".file-status").addClass("file-status-failed").html("Failed"),n.find(".file-percentage").html("").attr("title","Failed"),r.addClass("file-percentage-failed"),n.find(".file-percentage").append(r)),i=="progress"&&n.find(".file-status").addClass("file-status-inprogress").html("in progress"),i=="uploading"&&(n.find(".file-status").addClass("file-status-inprogress").html("uploading"),u=n.find(".file-percentage"),u.html(""))},_createInputandBind:function(){var i=t.buildTag("input","",{},{type:"file"});i.attr("name",this.control.id).attr("autocomplete","off").attr("class","e-uploadinput"),this.model.multipleFilesUpload&&i.attr("multiple","multiple"),i.appendTo(n("#"+this.control.id+" .selectionpart")),this._bindInputChangeEvent()},_showUploadButton:function(){var i=n("#"+this.control.id+" .upload-button");i.length==0&&(i=t.buildTag("button.upbutton upload-button",this.model.uploadButtonText),n("#"+this.control.id+" .selectionpart").after(i),(window.navigator.appName=="Microsoft Internet Explorer"||window.navigator.appName=="Netscape")&&(this.model.rtl?n(".selectionpart",this.control).css("float","right"):n(".selectionpart",this.control).css("float","left")),window.navigator.appName=="Microsoft Internet Explorer"?i.css("height","35px"):window.navigator.vendor=="Google Inc."&&i.css("padding","10px").css("margin-top","0px"),this._on(i,"click",this.__uploadButtonClick),n("#"+this.control.id).find(".upload-file-list").removeClass("remove"))},_resetFileInput:function(n){var t=n.clone(!1,!1);this._on(t,"change",this._inputValueChange),n.replaceWith(t)},_isAllowed:function(t){var f,i,u,r,e,o;return f=this.element.find(".e-uploadinput"),i=!1,u=this,this.model.fileFormatAllow!=""&&(e=this.model.fileFormatAllow.split(","),n(t).each(function(){if(n.inArray(this.extension,e)==-1)return r={action:"ExtensionsAllow",files:t},u._trigger("error",r),i=!0,!1})),this.model.fileFormatDeny!=""&&(o=this.model.fileFormatDeny.split(","),n(t).each(function(){if(n.inArray(this.extension,o)!=-1)return r={action:"ExtensionsDeny",files:t},u._trigger("error",r),i=!0,!1})),i&&this._resetFileInput(f),!i},_uploadHide:function(){fileList=n("#"+this.control.id+" .upload-file .file-action-cancel"),fileList.length==0&&(n("#"+this.control.id).find(".upload-file-list").addClass("remove"),n("#"+this.element[0].id+"_dialog").ejDialog("close"),n("#"+this.control.id).find(".upload-button").remove(),(window.navigator.appName=="Microsoft Internet Explorer"||window.navigator.appName=="Netscape")&&n(".selectionpart",this.control).css("float","none"))},_uploadFileListDelete:function(){var t,i;n("#"+this.element[0].id).find(".upload-file-list").remove(),t=this.element[0].id.replace("_dialog",""),n("#"+t).find(".upload-button").remove(),i=n("#"+t).find(".e-uploadinput"),a=n("#"+t).ejUploadbox("instance"),a._resetFileInput(i)},_onXhrSelect:function(t){var r,u,i,f;r=n(t.target),u=this._getInputFileInfo(r),this._xhrBeforeUpload(u,r),i=this,n.each(u,function(t,r){f=n(r).data("filelist"),i._setAction(f,"cancel"),i.model.autoUpload?i._xhrPerformUpload(r):i._showUploadButton()})},_xhrBeforeUpload:function(t){var i,r,u,f;return i=t,r=this,n.each(i,function(t,i){u=r._createFormObjectXhr(i),n(i).data("formobject",u),f=r._pushFileDetails(i),n(i).data("filelist",f)}),i},_xhrPerformUpload:function(t){var u,i,f,r;this._trigger("begin"),u=this.model.saveUrl,i=this,f=n(t).data("formobject"),r=new XMLHttpRequest,n(t).data("xhr",r),r.addEventListener("load",function(n){i._onRequestSuccess(i,n,t)},!1),r.addEventListener("error",function(n){i._onRequestError(i,n,t)},!1),r.upload.addEventListener("progress",function(n){i._onRequestProgress(i,n,t)},!1),r.open("POST",u),r.send(f)},_xhrOnUploadButtonClick:function(){var t,i,r;t=this,n(".upload-file-list li.upload-file",t.control).each(function(){i=n(this),r=t._isFileUpload(i),r&&t._xhrPerformUpload(n(i).data("file"))})},_xhrOnRemove:function(t,i){var r=n(i).find(".file-name").text().toString().split(",");n.ajax({url:this.model.removeUrl,type:"POST",data:"fileNames="+r,success:function(){n(i).remove()}})},_xhrOnCancel:function(t,i){var r,u;r=n(i).data("file"),u=n(r).data("xhr"),u&&n(r).data("xhr").abort(),n(r).data("xhr",null),n(i).data("file",null),n(i).remove(),this._uploadHide()},_xhrOnRetry:function(t,i){var r=n(i).data("file");this._xhrPerformUpload(r)},_onRequestSuccess:function(t,i,r){var u,e,o,s,f,h,c;u=n(r).data("filelist"),e=n(r).data("xhr"),t.model.removeUrl?(t._setAction(u,"remove"),t._setStatus(u,"success")):(u.find(".file-action").remove(),t._setStatus(u,"success")),n(r).length>0&&(o=n(u).find(".file-progress-status"),o.width("100%"),s=n(r)[0].size,f=this._formatSize(s),h=n(u).find(".file-size .file-name-text"),h.html(f+"\\"+f)),c={files:r,xhr:e,e:i},t._trigger("complete",c)},_onRequestError:function(t,i,r){var u,f,e;u=n(r).data("filelist"),f=n(r).data("xhr"),t._setAction(u,"retry"),t._setStatus(u,"failed"),e={action:"Error",files:r,xhr:f,e:i},t._trigger("error",e)},_onRequestProgress:function(t,i,r){var f,u;f=Math.round(i.loaded*100/i.total),u=n(r).data("filelist"),t._setProgress(u,f,i),t._setStatus(u,"progress")},_createFormObjectXhr:function(n){var t=new FormData;return t.append(this.control.id,n.rawFile),t},_getInputFileInfo:function(n){var t=n[0];return t.files?this._getAllFileInfo(t.files):[{name:this._GetName(t.value),extension:this._getFileExtensionType(t.value),size:this._getFileSizeinIE(t.value)}]},_getFileSizeinIE:function(n){var t,i;t=null,i=null;try{t=new ActiveXObject("Scripting.FileSystemObject")}catch(r){i=null}return t&&(i=t.getFile(n).size),i},_getFileExtensionType:function(n){return n.match?n.match(/\.([^\.]+)$/)[0]||"":""},_getAllFileInfo:function(t){var i=this;return n.map(t,function(n){return i._getFileInfo(n||t)})},_GetName:function(n){var t=n.lastIndexOf("\\");return t!=-1?n.substr(t+1):n},_getFileInfo:function(n){var t=n.name||n.fileName||n;return{name:t,extension:this._getFileExtensionType(t),size:n.size||n.fileSize,rawFile:n}},_formatSize:function(n){var t=-1;do n=n/1024,t++;while(n>99);return Math.max(n,.1).toFixed(1)+["KB","MB","GB","TB","PB","EB"][t]},_onSelectIFrame:function(t){var r,u,i,f;r=n(t.target),u=this._getInputFileInfo(r),i=this._beforeUploadIFrame(u),f=i.data("iframe"),this.model.autoUpload?this._performUploadIFrame(i):this._showUploadButton(),n(this.inputupload).unbind("change"),this._bindInputChangeEvent()},_onRemoveIFrame:function(t,i){var r,u;r=i.data("iframe"),u=n(i).find("span.file-name-text").text().toString().split(","),r?(this._removeFileEntry(i),this.model.removeUrl&&n.ajax({url:this.model.removeUrl,type:"POST",data:"fileNames="+u,success:function(){}})):this._removeFileEntry(i)},_onCancelIFrame:function(n,t){var i;this._trigger("cancel",{Status:t}),i=t.data("iframe"),i&&(this._removeFileEntry(t),typeof i.stop!="undefined"?i.stop():i.document&&(i.document.execCommand("Stop"),i.contentWindow.location.href=i.contentWindow.location.href),this._processServerResponse(i,"")),this._uploadHide()},_onRetryIFrame:function(t,i){var r=n(i).data("file");this._performUploadIFrame(r)},_beforeUploadIFrame:function(t){var i,u,r;return i=this._createFrame(this.control.id+"_Iframe"+this.Uploadframes.length),this.Uploadframes.push(i),u=this._createForm(this.model.saveUrl,i[0].id),n("#"+this.control.id+" input.e-uploadinput").removeClass("e-uploadinput").css("display","none").appendTo(u),this._createInputandBind(),r=this._pushFile(t,{iframe:i,form:u,file:t}),i.data({filelist:r}),this._setAction(r,"cancel"),r},_performUploadIFrame:function(n){var r,t,i;this._trigger("begin"),r=n.data("file"),this._setStatus(n,"uploading"),t=n.data("iframe"),i=n.data("form"),t.appendTo(document.body),i.appendTo(document.body),this._on(t,"load",this._removeFramesIFrame),i.submit()},_onUploadButtonClickIFrame:function(){var t,i,r;t=this,n(".upload-file-list li.upload-file",t.control).each(function(){i=n(this),r=t._isFileUpload(i),r&&t._performUploadIFrame(i)})},_removeFramesIFrame:function(t){var r,u,i,f,e;r=n(t.target);try{u=r.contents().text()}catch(t){u="Error trying to get server response: "+t}i=r.data("filelist"),f=i.data("file"),e={files:f},this._trigger("complete",e),this.model.removeUrl?(this._setAction(i,"remove"),this._setStatus(i,"success")):(i.find(".file-action").remove(),this._setStatus(i,"success")),this._processServerResponse(r,u)},_processServerResponse:function(t){var i;i=n(document.body).find("form[target='"+n(t).attr("id")+"']"),setTimeout(function(){i.remove(),t.remove()},0)},_createDivBlock:function(n){return t.buildTag("div."+n)},_createForm:function(n,i){return t.buildTag("form","",{},{enctype:"multipart/form-data",method:"POST",action:n,target:i})},_createFrame:function(n){return t.buildTag("iframe#"+n,"",{display:"none"},{name:n})},_createInput:function(n){return t.buildTag("input","",{},{type:"file",name:n})},_initObjectsSyncUpload:function(){this.element.closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data"),this._wireEventsSyncUpload()},_wireEventsSyncUpload:function(){var t=this.element.closest("form")[0];this._on(n(t),"submit",this._formSubmitSyncUpload),this._on(n(t),"reset",this._formResetSyncUpload)},_onSelectSyncUpload:function(t){var i,r,u,f;i=n(t.target),r=this._getInputFileInfo(i),u=n(".selectionpart",this.control),n("#"+this.control.id+" input.e-uploadinput").removeClass("e-uploadinput").css("display","none").appendTo(u),this._createInputandBind(),f=this._pushFile(r,{file:r,Input:i})},_onCancelSyncUpload:function(n,t){var i=t.data("Input");t.data("file",null),t.data("Input",null),t.remove(),i.remove()},_formSubmitSyncUpload:function(){var t,i;t=n(".e-uploadinput",this.control),t.attr("name",""),i=this.control,setTimeout(function(){t.attr("name",i.id)},0)},_formResetSyncUpload:function(){n(".selectionpart",this.control).children('input[type="file"]').each(function(){this.className==" "&&n(this).remove()}),n(".upload-file-list",this.control).remove()}})})(jQuery,Syncfusion)