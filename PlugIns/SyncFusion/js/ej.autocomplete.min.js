/*!
*  filename: ej.autocomplete.min.js
*  version : 11.2.0.63
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n,t){t.widget("ejAutocomplete","ej.Autocomplete",{element:{target:null},model:null,_rootCSS:"e-autocomplete",defaults:{dataSource:null,query:null,fields:null,template:null,grouping:!1,distinct:!1,cssClass:"",watermark:null,filter:"startswith",caseSensitive:!1,loadingImage:!0,listSize:0,minCharacter:1,dropdown:!1,highlightSearch:!1,autoFill:!1,rtl:!1,delimiter:null,disabled:!1,height:26,width:174,noResults:"No suggestions",showNoResults:!0,suggestionBoxHeight:null,suggestionBoxWidth:null,focusIn:null,focusOut:null,change:null,select:null},dataTypes:{cssClass:"string",filter:"enum",caseSensitive:"boolean",loadingImage:"boolean",template:"string",grouping:"boolean",distinct:"boolean",listSize:"number",minCharacter:"number",dropdown:"boolean",highlightSearch:"boolean",autoFill:"boolean",rtl:"boolean",delimiter:"string",noResults:"string",showNoResults:"boolean"},enable:function(){this.element.hasClass("disabled")&&(this.target.disabled=!1,this.element.removeClass("disabled"),this.model.dropdown&&(this.dropdownbutton.removeClass("disabled"),this.dropdownbutton.bind("mousedown",n.proxy(this._OnDropdownClick,this))))},disable:function(){this.element.hasClass("disabled")||(this.target.disabled=!0,this.element.addClass("disabled"),this.model.dropdown&&(this.dropdownbutton.addClass("disabled"),this.dropdownbutton.unbind("mousedown",n.proxy(this._OnDropdownClick,this))))},clearText:function(){this.element.val(""),this._isFocused?this.element.blur():this._targetBlur()},getValue:function(){return this.element.hasClass("watermark")?"":this.target.value},_changeWatermark:function(n){this._isWatermark?this.element.attr("placeholder",n):this.element.hasClass("watermark")&&this.element.val(n)},_changeSkin:function(n){this.model.cssClass!=n&&(this.element.removeClass(this.model.cssClass).addClass(n),this.model.dropdown&&this.wrapper.removeClass(this.model.cssClass).addClass(n))},_setDropdown:function(n){this.model.dropdown!=n&&(this.model.dropdown=n,n?this._renderDropdown():this._destroyDropdown())},_setRTL:function(n){this.model.rtl!=n&&(this.model.rtl=n,this._RightToLeft(),this._reRenderDD())},_changeHeight:function(n){this.element.height(n),this._reRenderDD()},_changeWidth:function(n){this.element.width(n),this._reRenderDD(),this._setListWidth()},_reRenderDD:function(){this.model.dropdown&&(this._destroyDropdown(),this._renderDropdown())},_init:function(){this._initialize(),this._render(),this._wireEvents()},_setModel:function(n){if(this.element.hasClass("disabled"))return!1;var t;for(t in n)switch(t){case"watermark":this._changeWatermark(n[t]);break;case"dropdown":this._setDropdown(n[t]);break;case"rtl":this._setRTL(n[t]);break;case"delimiter":n[t]=this._validateDelimiter(n[t]);break;case"disabled":this._disabled(n[t]);break;case"height":this._changeHeight(n[t]);break;case"width":this._changeWidth(n[t]);break;case"cssClass":this._changeSkin(n[t])}},_destroy:function(){this.model.dropdown&&this._destroyDropdown(),this._isWatermark&&this.element.removeAttr("placeholder"),this.element.removeClass("e-input watermark "+this.model.cssClass),this.target.value="",this.suggestionList.remove()},_initialize:function(){this.target=this.element[0],this.showSuggestionBox=!1,this._queryString=null,this.suggLen=0,this._delimiterIndex=null,this._activeItem=0,this._suggestionListID="#"+this.target.id+"_suggestion ul li:not('.e-category')",this.ctrlKeyPressed=!1,this._isFocused=!1,this._isOpened=!1,this.ddWidth=0,this._isWatermark=this._checkWatermarkSupport()},_render:function(){this.element.addClass("e-input "+this.model.cssClass),this._setDimentions(),this._renderDropdown(),this._setWatermark(),this._checkProperties(),this._renderSuggestionList(),this._RightToLeft()},_renderDropdown:function(){if(this.model.dropdown){this.wrapper=t.buildTag("span.e-autocomplete-wrapper "+this.model.cssClass+"#"+this.target.id+"_wrapper");var r=t.buildTag("span.arrow"),i;this.dropdownbutton=t.buildTag("span.dropdown#"+this.target.id+"_dropdown").append(r),this.wrapper.insertAfter(this.element),this.wrapper.append(this.element),this.wrapper.append(this.dropdownbutton),this.dropdownbutton.height(this.element.height()),this.model.rtl?(this.dropdownbutton.css({left:"0","border-right":"none"}).addClass("e-rtl"),i="padding-left"):(this.dropdownbutton.css({right:"0","border-left":"none"}),i="padding-right"),this.ddWidth=this.dropdownbutton.outerWidth()>0?this.dropdownbutton.outerWidth():24,this.wrapper.css(i,this.ddWidth),this.element.width(this.element.width()-this.ddWidth),this.dropdownbutton.bind("mousedown",n.proxy(this._OnDropdownClick,this))}},_setDimentions:function(){this.model.height&&this.element.height(this.model.height),this.model.width&&this.element.width(this.model.width)},_checkProperties:function(){this.model.delimiter!=null&&(this.model.delimiter=this._validateDelimiter(this.model.delimiter)),this.model.disabled&&this._disabled(!0),this._checkNameAttr()},_checkNameAttr:function(){this.element.attr("name")||this.element.attr({name:this.element[0].id})},_disabled:function(n){n?this.disable():this.enable()},_destroyDropdown:function(){this.element.insertAfter(this.wrapper),this.element.width(this.element.width()+this.dropdownbutton[0].offsetWidth),this.wrapper.remove(),this.dropdownbutton.unbind("mousedown",n.proxy(this._OnDropdownClick,this))},_validateDelimiter:function(n){if(n.length==1)if(!/^[a-zA-Z0-9]+$/.test(n))return n;return null},_checkWatermarkSupport:function(){return"placeholder"in document.createElement("input")},_setWatermark:function(){this._isWatermark?this.element.attr("placeholder",this.model.watermark):this.model.watermark!=null&&n.trim(this.element.val())==""&&(this.element.addClass("watermark"),this.element.val(this.model.watermark))},_renderSuggestionList:function(){this.suggestionList=t.buildTag("div.e-autocomplete-list "+this.model.cssClass+"#"+this.target.id+"_suggestion","",{display:"none"});var i=t.buildTag("div");this.ul=t.buildTag("ul"),i.append(this.ul),this.suggestionList.append(i),n("body").append(this.suggestionList),this._setListWidth(),this._setListHeight(),this.suggestionList.ejScroller({height:this.suggestionList.height(),width:0,scrollerSize:20}),this.scrollerObj=this.suggestionList.ejScroller("instance")},_showSuggestionList:function(){if(!this.suggestionListItems)return this.noresult=!0,!1;this.suggestionListItems.length==0?(this.suggestionListItems.push(this.model.noResults),this.noresult=!0):this.noresult=!1,(!this.noresult||this.model.showNoResults)&&this._generateSuggestionList()},_generateSuggestionList:function(){var i=this.suggestionListItems,r,s,n,u,h,f,e,o;if(this.ul.empty(),typeof i[0]!="object"){for(this.model.distinct&&(i=t.dataUtil.distinct(i,"",!0)),r=0;r<i.length;r++)s=this.model.highlightSearch&&!this.noresult?this._highlightSuggestion(i[r]):i[r],this.ul.append(t.buildTag("li",s));this._currList=i,this._txtMapper=null}else if(n=this.model.fields,u={_key:null,_text:null,_attr:null},u._key=n&&n.uniqueKey?n.uniqueKey:"uniqueKey",u._text=n&&n.text?n.text:"text",u._attr=n&&n.htmlAttr?n.htmlAttr:"htmlAttr",this._txtMapper=u._text,this._currList=[],this.model.distinct&&(i=t.dataUtil.distinct(i,u._text,!0)),this.model.grouping)for(h=n&&n.category?n.category:"category",o=0,f=t.DataManager(i).executeLocal(t.Query().group(h).sortBy("key",!1)),e=f[f.length-1],e.key||(this._generateLi(e.items,u),o=1),r=0;r<f.length-o;r++)f[r].key&&this.ul.append(t.buildTag("li.e-category",f[r].key)),this._generateLi(f[r].items,u);else this._generateLi(i,u);this._showResult()},_generateLi:function(t,i){for(var u,f,r=0;r<t.length;r++)u=n(document.createElement("li")).attr(t[r][i._key]?{key:t[r][i._key]}:{}),f=this.model.template?this._getTemplatedString(t[r]):t[r][i._text],this.model.highlightSearch&&(f=this._highlightSuggestion(f)),u.append(f),this._setAttributes(t[r][i._attr],u),this.ul.append(u);this._currList=n.merge(this._currList,t)},_getTemplatedString:function(n){for(var t=this.model.template,i=t.indexOf("${"),r=t.indexOf("}"),u,f;i!=-1&&r!=-1;)u=t.substring(i,r+1),f=u.replace("${","").replace("}",""),t=t.replace(u,n[f]),i=t.indexOf("${"),r=t.indexOf("}");return t},_setAttributes:function(n,t){if(n)for(var i in n)t.attr(i,n[i])},_setListWidth:function(){this.model.suggestionBoxWidth?this.suggestionList.width(this.model.suggestionBoxWidth):this.suggestionList.css("min-width",this.element.width()+this.ddWidth)},_setListHeight:function(){this.model.listSize>0?this.suggestionList.css({"max-height":this.model.listSize*30}):this.suggestionList.css({"max-height":this.model.suggestionBoxHeight||"150px"})},_showResult:function(){this._setListPosition(),this._isOpened?this._refreshScroller():(this._refreshScroller(),this.suggestionList.css("display","none"),this.suggestionList.slideDown(200,"easeOutQuad")),this._isOpened=!0,this.showSuggestionBox=!0;var t=n(this._suggestionListID);this._listSize=t.size(),n(document).bind("mousedown",n.proxy(this._OnDocumentClick,this)),t.bind("mouseenter",n.proxy(this._OnMouseEnter,this)),t.bind("mouseleave",n.proxy(this._OnMouseLeave,this)),t.bind("mousedown",n.proxy(this._OnMouseClick,this))},_hideResult:function(){if(this.showSuggestionBox){if(this.showSuggestionBox=!1,this._activeItem=0,this._isOpened)this.suggestionList.css("display","none"),this.ul.empty();else{var t=this;this.suggestionList.slideUp(100,"easeOutQuad",function(){t.ul.empty()})}n(document).unbind("mousedown",n.proxy(this._OnDocumentClick,this))}},_refreshScroller:function(){this.suggestionList.css("height","auto"),this.suggestionList.find(".content, .vScroll").removeAttr("style"),this.suggestionList.find(".vScroll div").removeAttr("style"),this.suggestionList.css("display","block"),this.scrollerObj.model.height=this.suggestionList.height(),this.scrollerObj.model.scrollTop=0,this.scrollerObj.refresh(),this.suggestionList.css("height","auto")},_setListPosition:function(){var n=this.wrapper?this.wrapper:this.element,t=n.offset(),i=t.left,r=n.outerHeight(),u=(r-n.height())/2,f=this._getZindexPartial();this.model.rtl&&(i-=this.suggestionList.outerWidth()-n.outerWidth()),this.suggestionList.css({left:i+"px",top:t.top+r-u+3+"px","z-index":f})},_getZindexPartial:function(){var r="#"+this.target.id+"_suggestion",i=this.element.parents(),u=i.length,f=n("body").children(":not("+r+")"),t;return n(f).each(function(n,t){i[u+n]=t}),t=Math.max.apply(t,n.map(i,function(t){if(n(t).css("position")!="static")return parseInt(n(t).css("z-index"))||1})),!t||t<1e4?t=1e4:t+=1,t},_targetFocus:function(){this.element.hasClass("watermark")&&(this.element.removeClass("watermark"),this.element.val(null)),this.wrapper?this.wrapper.addClass("e-focused"):this.element.addClass("e-focused"),this._isFocused=!0,this.model.focusIn&&this._trigger("focusIn")},_targetBlur:function(){var t,r,u,i;this._isFocused=!1,this.wrapper?this.wrapper.removeClass("e-focused"):this.element.removeClass("e-focused"),this._isOpened=!1,this._hideResult(),this.model.delimiter&&(t=n.trim(this.element.val()),r=this.model.delimiter,u=t.substr(t.length-r.length,t.length),u==r&&this.element.val(t.substr(0,t.length-r.length))),this._isWatermark||this.model.watermark==null||n.trim(this.element.val())!==""||(this.element.val(this.model.watermark),this.element.addClass("watermark")),i=this._getCaretSelection(),this.model.autoFill&&i.end-i.start!=0&&i.end-i.start!=this.element.val().length&&(this.target.value=this.target.value.substr(0,i.start)),this.model.focusOut&&this._trigger("focusOut")},_removeListHover:function(){n(this._suggestionListID).removeClass("listHover")},_addListHover:function(){var n=this._getActiveItem();n.addClass("listHover"),this.scrollerObj.setModel({scrollTop:this._calcScrollTop()}),n.focus()},_calcScrollTop:function(){for(var u=this.ul[0].offsetHeight,i=this.ul.find("li"),r=0,t=this.ul.find("li.listHover").index(),n=0;n<t;n++)r+=i[n].offsetHeight;return r-(this.suggestionList[0].offsetHeight-i[t].offsetHeight)/2},_getActiveItem:function(){return n(n(this._suggestionListID)[this._activeItem-1])},_getActiveText:function(){return this._txtMapper?this._currList[this._activeItem-1][this._txtMapper]:this._currList[this._activeItem-1]},_setTextBoxValue:function(){var t,r,i,u,f;this._activeItem&&!this.noresult&&(t=this._getActiveItem().text(),r=this._getCaretSelection(),i=this.model.autoFill?this.target.value.substr(0,r.start):this.target.value,this.model.delimiter?(this._delimiterIndex=this.target.value.lastIndexOf(this.model.delimiter),f=n.trim(i.substr(this._delimiterIndex+1,r.start)),u=i+t.substr(f.length,t.length)):u=i+t.substr(i.length,t.length),this.element.val(u))},_enterTextBoxValue:function(){if(this._activeItem&&!this.noresult){var t=this._getActiveItem(),n=this._getActiveText();this.model.delimiter?(this._delimiterIndex=this.target.value.lastIndexOf(this.model.delimiter),this.element.val(this._queryString.substr(0,this._delimiterIndex+1)+n+this.model.delimiter+" ")):this.element.val(n),this._moveCaretToEnd(this.element[0]),this.model.select&&this._trigger("select",{text:this.target.value,selectedText:n,uniqueKey:t.attr("key")}),this._valueChange()}},_addLoadingClass:function(){this.model.loadingImage&&this.element.addClass("onloading")},_removeLoadingClass:function(){this.element.removeClass("onloading")},_highlightSuggestion:function(t){if(n.trim(this._queryString)!=""){var f,e,i,r,o,u;f=this.model.caseSensitive?"g":"gi",u=n.trim(this._queryString),e=this.model.filter=="startswith"?"^"+u:u,i=new RegExp(e,f),i.test(t)&&(r=t.match(i),o=t.split(i),t="",n(o).each(function(n,i){t+=r[n]?i+"<span class='HighlightedText'>"+r[n]+"<\/span>":i}))}return t},_RightToLeft:function(){this.model.rtl?(this.element.addClass("e-rtl"),this.suggestionList.addClass("e-rtl")):(this.element.removeClass("e-rtl"),this.suggestionList.removeClass("e-rtl"))},_OnKeyDown:function(t){this.model.filter!="startswith"&&(this.model.autoFill=!1);switch(t.keyCode){case 38:t.preventDefault(),this.showSuggestionBox&&this.suggestionList&&(this._removeListHover(),this._activeItem>1?this._activeItem-=1:this._activeItem=this._listSize,this._addListHover(),this.model.autoFill&&(this._queryString=this.target.value,this._setTextBoxValue(),this._autofilSelection()));break;case 40:if(t.preventDefault(),this.showSuggestionBox&&this.suggestionList){if(this._removeListHover(),this._activeItem<this._listSize?this._activeItem+=1:this._activeItem=1,this._addListHover(),this.model.autoFill){this._queryString=this.target.value;var i=this._getCaretSelection();this.suggLen=i.start,this._setTextBoxValue(),this._autofilSelection()}}else this.model.dropdown&&this._OnDropdownClick(t);break;case 8:n.trim(this.element.val())==""&&(this._isOpened=!1);break;case 17:this.ctrlKeyPressed=!0;break;case 9:this.showSuggestionBox&&(t.preventDefault(),this._queryString=this.element.val(),this._enterTextBoxValue(),this._hideResult());break;case 27:this._hideResult()}},_OnKeyUp:function(t){var r,i;if(this.ctrlKeyPressed)return t.keyCode==17&&(this.ctrlKeyPressed=!1),!1;if(r=t.target,this._queryString=t.target.value,n.trim(this.element.val())==""&&t.keyCode==38&&t.keyCode==40)return this._hideResult(),!1;if(i=this._checkDelimiter(),!i)return!1;this._queryString=n.trim(this._queryString);switch(t.keyCode){case 38:case 40:case 37:case 39:case 20:case 16:case 17:case 18:case 35:case 36:case 144:case 9:case 27:break;case 13:t.preventDefault(),this._queryString=this.element.val(),this._enterTextBoxValue(),this.model.autoFill&&(this.suggLen=this.element.val().length,this._autofilSelection()),this._isOpened=!1,this._hideResult();break;case 8:this._queryString.length>=this.model.minCharacter?(this._autoFill=!1,this._OnTextEnter()):(this._hideResult(),n.trim(this.element.val())==""&&(this._isOpened=!1));break;default:this._queryString.length>=this.model.minCharacter&&(this._autoFill=!0,this._OnTextEnter())}},_getFilteredList:function(n){if(!n||n.length<1)this.suggestionListItems=null;else{var i=t.Query();this._addQuery(i,typeof n[0]=="object"),this.suggestionListItems=t.DataManager(n).executeLocal(i)}this._doneRemaining()},_getSearchResult:function(n){if(t.DataManager&&n instanceof t.DataManager){window.clearTimeout(this.timer);var i=this;this.timer=window.setTimeout(function(){i._fetchRemoteDat(n)},700)}else this._getFilteredList(n)},_fetchRemoteDat:function(n){var t=this,i,r=this._getQuery();this._addQuery(r,!0),i=n.executeQuery(r),i.fail(function(){t.suggestionListItems=null,t._removeLoadingClass()}).done(function(n){t.suggestionListItems=n.result,t._doneRemaining()})},_addQuery:function(n,t){var i="",r;t&&(r=this.model.fields,i=r&&r.text?r.text:"text"),this._queryString?n.where(i,this.model.filter,this._queryString,!this.model.caseSensitive).sortBy(i,!1):n.sortBy(i,!1)},_getQuery:function(){var u;if(t.isNullOrUndefined(this.model.query)){var r=[],i=t.Query(),n=this.model.fields;for(u in n)u!=="tableName"&&r.push(n[u]);r.length>0&&i.select(r),this.model.dataSource.dataSource.url.match(n.tableName+"$")||t.isNullOrUndefined(n.tableName)||i.from(n.tableName)}else i=this.model.query.clone();return i},_OnTextEnter:function(){this._addLoadingClass(),this._hideResult(),this._getSearchResult(this.model.dataSource)},_doneRemaining:function(){if(this._showSuggestionList(),this.model.autoFill&&this._autoFill&&!this.noresult){this._activeItem=1,this._queryString=this.target.value;var n=this._getCaretSelection();this.suggLen=n.start,this._setTextBoxValue(),this._autofilSelection()}this._removeLoadingClass()},_checkDelimiter:function(){return this._delimiterIndex=this.model.delimiter?this.target.value.lastIndexOf(this.model.delimiter):-1,this._delimiterIndex==-1?(this._queryString=this.target.value,!0):this._delimiterIndex+1==this._queryString.length?(this._hideResult(),!1):(this._queryString=this.target.value.substr(this._delimiterIndex+1,this._queryString.length),!0)},_autofilSelection:function(){var n=this.element.val().length;this.target.setSelectionRange(this.suggLen,n)},_OnDropdownClick:function(n){n.preventDefault(),this._addLoadingClass(),this.showSuggestionBox&&this._hideResult(),this._showFullList()},_showFullList:function(){this._isFocused||this.element.focus(),this._queryString=null,this._autoFill=!1,this._getSearchResult(this.model.dataSource)},_OnMouseEnter:function(t){var r=t.target,i;t.target.tagName!="LI"&&(r=n(t.target).parents("li")),n(this._suggestionListID).removeClass("listHover"),n(r).addClass("listHover"),i=0,n(this._suggestionListID).each(function(t){if(n(this).hasClass("listHover"))return i=t,!1}),this._queryString=this.element.val(),this._activeItem=i+1},_OnMouseLeave:function(){n(this._suggestionListID).removeClass("listHover"),this.model.highlightSearch&&n(this._suggestionListID+" .HighlightedText").removeClass("listHover")},_OnMouseClick:function(n){n.preventDefault(),this.noresult||(this._enterTextBoxValue(),this._isOpened=!1,this._hideResult())},_OnDocumentClick:function(t){var i=null,r;this.model.dropdown&&(i=this.dropdownbutton[0].id,r=this.dropdownbutton.children()[0]),n(t.target).parents().hasClass("vScroll")||n(t.target).hasClass("vScroll")||n(t.target).hasClass("e-category")?t.preventDefault():t.target.id!=i&&t.target!=r&&t.target!=this.suggestionList[0]&&t.target!=this.element[0]&&(this._isOpened=!1,this._hideResult())},_valueChange:function(){this.model.change&&this._trigger("change",{text:this.target.value})},_moveCaretToEnd:function(n){if(typeof n.selectionStart=="number")n.selectionStart=n.selectionEnd=n.value.length;else if(typeof n.createTextRange!="undefined"){var t=n.createTextRange();t.collapse(!1),t.select()}},_getCaretSelection:function(){var n=this.element[0],t=0,i=0;return isNaN(n.selectionStart)||(t=n.selectionStart,i=n.selectionEnd),{start:Math.abs(t),end:Math.abs(i)}},_wireEvents:function(){this._on(this.element,"focus",this._targetFocus),this._on(this.element,"blur",this._targetBlur),this._on(this.element,"keydown",this._OnKeyDown),this._on(this.element,"keyup",this._OnKeyUp),this._on(this.element,"input",this._valueChange)}}),t.filter={StartsWith:"startswith",Contains:"contains",EndsWith:"endswith",LessThan:"lessthan",GreaterThan:"greaterthan",LessThanOrEqual:"lessthanorequal",GreaterThanOrEqual:"greaterthanorequal",Equal:"equal",NotEqual:"notequal"}})(jQuery,Syncfusion)