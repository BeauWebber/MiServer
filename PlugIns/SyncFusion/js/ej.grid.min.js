/*!
*  filename: ej.grid.min.js
*  version : 11.2.0.63
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function gridResize(n){this.$headerTable=n.getGridHeaderTable(),this.gridInstance=n,this._colMinWidth=15,this._$visualElement=$(),this._currentCell=-1,this._allowStart=!1,this._oldWidth=null,this._orgX=null,this._orgY=null,this._extra=null,this._expand=!1}(function(n,t,i){t.widget("ejGrid","ej.Grid",{_rootCSS:"e-grid",element:null,model:null,keyConfigs:{focus:"e",insertRecord:"45",deleteRecord:"46",editRecord:"113",saveRequest:"13",cancelRequest:"27",nextPage:"34",previousPage:"33",lastPage:"ctrl+alt+34",firstPage:"ctrl+alt+33",nextPager:"alt+34",previousPager:"alt+33",firstCellSelection:"36",lastCellSelection:"35",firstRowSelection:"ctrl+36",lastRowSelection:"ctrl+35",upArrow:"38",downArrow:"40",selectedGroupExpand:"alt+40",totalGroupExpand:"ctrl+40",selectedGroupCollapse:"alt+38",totalGroupCollapse:"ctrl+38"},_ignoreOnPersist:["query","isEdit","toolBarClick","queryCellInfo","currentViewData","altRow","rtl","rowDataBound","rowTemplate","detailData","detailTemplate","summaryRows","toolBar","edit","allowMultiSorting","autoSaveOnRowSelection","localization","allowScrolling","cssClass","dataSource","enableEffects","rowHover","allowSummary","editOnDoubleClick","headerEffects","allowKeyboardNavigation"],defaults:{allowPaging:!1,allowSorting:!1,allowFiltering:!1,allowSelection:!0,enableEffects:!0,allowSummary:!1,rowHover:!0,persist:!1,editOnDoubleClick:!0,selectedRow:-1,allowSearching:!1,headerEffects:!1,allowReordering:!1,allowKeyboardNavigation:!0,selectionType:"single",dataSource:null,cssClass:"",allowScrolling:!1,localization:"en-US",autoSaveOnRowSelection:!0,allowMultiSorting:!1,edit:{allowEditing:!1,allowAdding:!1,allowDeleting:!1,editMode:"normal",dialogEditorTemplateId:null},pageSettings:{pageSize:12,pageCount:8,currentPage:1,totalPages:null},groupSettings:{toggleGrouping:!1,groupedColumnShow:!0,showUngroupButton:!0,showAnimateButton:!0,groupedColumns:[]},filterSettings:{filterType:"filterbar",filterBarMode:"immediate",showFilterBarMessage:!0,statusBarWidth:450,showPredicate:!1},sortSettings:{sortedColumns:[]},toolBar:{allowToolBar:!1,toolBarItems:[]},scrolling:{width:null,heigth:null},summaryRows:[],detailTemplate:null,detailData:null,rowTemplate:null,rowDataBound:null,rtl:!1,altRow:!0,currentViewData:null,queryCellInfo:null,toolBarClick:null,columns:[],query:t.Query(),isEdit:!1},getGridHeaderTable:function(){return this._gridHeaderTable},setGridHeaderTable:function(n){this._gridHeaderTable=n},getGridContentTable:function(){return this._gridContentTable},setGridContentTable:function(n){this._gridContentTable=n},getGridPager:function(){return this._gridPager},getGridRows:function(){return this._gridRows},setGridPager:function(n){this._gridPager=n},getGridFilterBar:function(){return this._gridFilterBar},setGridFilterBar:function(n){this._gridFilterBar=n},getCurrentViewData:function(){return this._currentJsonData},_init:function(){this._trigger("load"),this._initPrivateProperties(),(this.model.width||this.model.height)&&(this.model.allowScrolling=!0,this.model.width&&(this.model.scrolling.width=this.model.width),this.model.height&&(this.model.scrolling.height=this.model.height)),(this.model.edit.allowEditing||this.model.edit.allowAdding)&&this._processEditing(),this._checkDataBinding(),this.model.allowFiltering&&this.model.filterSettings.filterType=="menu"&&this._renderFilterDialogs()},_setModel:function(i){var r,u,e,f,o,s;for(r in i)switch(r){case"pageSettings":n.extend(this.model.pageSettings,i[r]),this.getGridPager().ejPager("option",i[r]),this.refreshGridContent();break;case"allowPaging":this.model.allowPaging=i[r],i[r]&&this.element.children(".e-pager").length==0?(this.element.append(this._renderGridPager()),this.refreshGridContent(),this.getGridPager().ejPager("refreshPager")):(this.getGridPager().remove(),this.setGridPager(null),this.refreshGridContent());break;case"allowGrouping":i[r]&&this.element.children(".groupdroparea").length==0?(this.model.allowGrouping=i[r],this.addGroupingTemplate(),this.element.prepend(this._renderGroupDropArea()),this._enableGroupingEvents(),this._headerCellgDragDrop()):this.element.children(".groupdroparea").remove();break;case"groupSettings":n.extend(this.model.groupSettings,i[r]),this.templateRefresh(),this.model.groupSettings.toggleGrouping&&(u=this._renderGridHeader().find("table"),this.element.children(".gridheader").find("table").replaceWith(u),this.setGridHeaderTable(u),this.setWidthToColumns());break;case"cssClass":this.element.removeClass(this.model.cssClass).addClass(i[r]);break;case"allowFiltering":case"filterSettings":if(r=="filterSettings"?n.extend(this.model.filterSettings,i[r]):this.model.allowFiltering=i[r],this.model.allowFiltering){if(this.model.filterSettings.filterType==t.Grid.filterType.FilterBar)for(this.getGridHeaderTable().find(".filterbar").remove(),this.getGridHeaderTable().find(".columnheader").find(".filtericon").remove().end().find(".headercellfilter").removeClass("headercellfilter"),this._renderFiltering(),this.model.filterSettings.showFilterBarMessage&&this._createStatusBar(),e=this.getGridHeaderTable().find(".filterbar"),f=0;f<this.model.groupSettings.groupedColumns.length;f++)e.prepend(this._getEmptyFilterBarCell());else this.model.filterSettings.filterType==t.Grid.filterType.Menu&&(this.getGridHeaderTable().find(".columnheader").find(".filtericon").remove().end().find(".headercellfilter").removeClass("headercellfilter"),this.getGridHeaderTable().find(".filterbar").remove(),this.getGridHeaderTable().find(".columnheader").find(".headercell").addClass("headercellfilter").append(t.buildTag("div.filtericon")),this._renderFilterDialogs());this._enableFilterEvents()}else this.model.filterSettings.filterType==t.Grid.filterType.FilterBar?this.getGridHeaderTable().find(".filterbar").remove():this.model.filterSettings.filterType==t.Grid.filterType.Menu&&this.getGridHeaderTable().find(".columnheader").find(".filtericon").remove().end().find(".headercellfilter").removeClass("headercellfilter"),this._filterCollection=[],this.refreshGridContent();break;case"rowHover":this.model.rowHover=i[r],this._enableRowHover();break;case"allowScrolling":i[r]?(this.element.children(".gridcontent").ejScroller("destroy"),this._renderScroller()):(this.element.children(".gridcontent").ejScroller("destroy"),this.element.children(".gridheader").removeClass("scrollcss").end().css("width","auto"));break;case"localization":this.model.localization=i[r],o=this.model,this.element.ejGrid("destroy").ejGrid(o);break;case"dataSource":this.model.dataSource=i[r]instanceof t.DataManager?i[r]:t.DataManager(i[r]),this.getGridPager().ejPager("model.currentPage",1),this.refreshGridContent(!0);break;case"editOnDoubleClick":this._off(this.element,"dblclick",".gridcontent"),i[r]&&this._on(this.element,"dblclick",".gridcontent",this._editdblClickHandler);break;case"selectedRow":this.selectRows(i[r]);break;case"edit":n.extend(this.model.edit,i[r]),this._processEditing(),(this.model.edit.allowEditing||this.model.edit.allowAdding)&&(this.model.edit.editMode=="dialog"||this.model.edit.editMode=="dialogTemplate")&&(n("#"+this._id+"_dialogEdit_wrapper,#"+this._id+"_dialogEdit").remove(),this.element.append(this._renderDialog())),this._enableEditingEvents();break;case"enableEffects":this.model.enableEffects=!0,i[r]?this.collapseGroupDropArea():this.expandGroupDropArea();break;case"allowSummary":case"summaryRows":r!="allowSummary"||i[r]?(s=this.element.find(".gridcontent").first(),this._renderGridFooter().insertAfter(s)):this.element.children(".gridfooter").remove();break;case"altRow":this.model.altRow=i[r],this.addInitTemplate(),this.refreshGridContent();break;case"toolBar":n.extend(this.model.toolBar,i[r]),this.element.children(".gridtoolbar").remove(),this.model.toolBar.allowToolBar&&this._renderToolBar().insertBefore(this.element.find(".gridheader").first());break;case"sortSettings":n.extend(this.model.sortSettings,i[r]),this.refreshGridContent();break;case"allowSelection":i[r]&&this._off(this.element,"click")._on(this.element,"click",this._clickHandler)}},_checkDataBinding:function(){if(this.model.query=new t.Query,this._initialRenderings(),this._initialRender=!0,this._ensureDataSource(),this._trigger("actionBegin"),this.element.addClass("e-grid-core"),this.model.rtl&&this.element.addClass("e-rtl"),this.model.cssClass!=null&&this.element.addClass(this.model.cssClass),this.model.allowGrouping&&this.element.append(this._renderGroupDropArea()),this.model.toolBar.allowToolBar&&this.element.append(this._renderToolBar()),this.element.append(this._renderGridHeader()),this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar"&&this._renderFiltering(),this.model.allowPaging&&this.element.append(this._renderGridPager()),n.isFunction(n.fn.ejWaitingPopup)&&(this.element.ejWaitingPopup({autoDisplay:!1}),n("#"+this._id+"_WaitingPopup").addClass("gridwaitingpopup")),this.model.dataSource instanceof t.DataManager)if(this.element.ejWaitingPopup("show"),this.model.dataSource.ready!=i){var r=this;this.model.dataSource.ready.done(function(n){r._initDataSource(),r.model.dataSource=t.DataManager(n.result)})}else this.element.ejWaitingPopup("show"),this._initDataSource();else this._initGridRender()},_initDataSource:function(){var n=this.model.dataSource.executeQuery(this.model.query);this._dataManager.dataSource.table!=null&&this._dataManager.dataSource.table.css("display","none"),n.done(t.proxy(function(n){this.element.ejWaitingPopup("hide"),this.model.currentViewData=n.result,this._totalRecordsCount=n.count==0&&n.result.length?n.result.length:n.count,this._initGridRender()},this))},_renderFilterDialogs:function(){var i,r,u,f;n.each(this.model.columns,t.proxy(function(n,t){t.type!="string"||i?t.type!="number"||r?t.type!="date"||f?t.type!="boolean"||u||(u=!0,this._renderBoolDialog()):(f=!0,this._renderDateDialog()):(r=!0,this._renderNumDialog()):(i=!0,this._renderStringDialog())},this))},_renderStringDialog:function(){var n=this._id+"_stringDlg",i=t.buildTag("div#"+n+".dlgcontainer");i.appendTo("body"),this._renderFDialog(n),this._renderDlgContent(i,"string")},_renderBoolDialog:function(){var i=this._id+"_booleanDlg",r=t.buildTag("div#"+i+".dlgcontainer");r.appendTo("body"),this._renderFDialog(i),this.model.filterSettings.showPredicate?n("#"+i).ejDialog({minHeight:136}):n("#"+i).ejDialog({minHeight:90}),this._renderDlgContent(r,"boolean")},_renderNumDialog:function(){var n=this._id+"_numberDlg",i=t.buildTag("div#"+n+".dlgcontainer");i.appendTo("body"),this._renderFDialog(n),this._renderDlgContent(i,"number")},_renderDateDialog:function(){var n=this._id+"_dateDlg",i=t.buildTag("div#"+n+".dlgcontainer");i.appendTo("body"),this._renderFDialog(n),this._renderDlgContent(i,"date")},_renderFDialog:function(t){n("#"+t).ejDialog({autoOpen:!1,rtl:this.model.rtl,cssClass:this.model.cssClass,showHeader:!1,width:260,resizable:!1,allowKeyboardNavigation:!1,contentContainer:"#"+this._id})},_renderDlgContent:function(i,r){i.addClass("e-grid-core");var f=t.buildTag("div.predicate"),s=t.buildTag("div.operator"),e=t.buildTag("div.value"),c=t.buildTag("input#"+this._id+r+"_ddinput",{},{},{type:"text"}),l=t.buildTag("div#"+this._id+r+"_dropdown"),h=t.buildTag("ul"),a=t.buildTag("input",{},{},{type:"radio",name:this._id+"_predicate"+r,value:"or"}),v=t.buildTag("input",{},{},{type:"radio",name:this._id+"_predicate"+r,value:"and",checked:"checked"}),o;f.append(v).append(t.buildTag("span.caption").html("AND")).append(a).append(t.buildTag("span.caption").html("OR")),this.model.filterSettings.showPredicate||f.hide(),r=="string"&&(o=t.buildTag("input",{},{},{type:"checkbox"}),f.append(o).append(t.buildTag("span.caption").html("Match Case")),n.each(["StartsWith","EndsWith","Contains","Equal","NotEqual"],function(n,i){h.append(t.buildTag("li").html(i))})),(r=="number"||r=="date")&&n.each(["LessThan","GreaterThan","LessThanOrEqual","GreaterThanOrEqual","Equal","NotEqual"],function(n,i){h.append(t.buildTag("li").html(i))}),r!="boolean"&&(l.append(h),s.append(c),s.append(l));var u=t.buildTag("input",{},{},{type:"text"}),y=t.buildTag("input",{},{},{type:"checkbox"}),p=t.buildTag("input.filter",{},{},{type:"button",value:"Filter"}),w=t.buildTag("input.clear",{},{},{type:"button",value:"Clear"});e.append(t.buildTag("span.caption").html("Filter : ")),i.append(f),r=="boolean"?e.append(y):(e.append(t.buildTag("br")).append(u),i.append(s)),i.append(e),i.append(t.buildTag("div.dlgBtns").append(p).append(w)),c.ejDropDownList({cssClass:this.model.cssClass,rtl:this.model.rtl,targetId:this._id+r+"_dropdown",width:"230px",height:"26px",selectedItem:0}),a.ejRadioButton({cssClass:this.model.cssClass,rtl:this.model.rtl}),v.ejRadioButton({cssClass:this.model.cssClass,rtl:this.model.rtl}),o&&o.ejCheckBox({cssClass:this.model.cssClass,rtl:this.model.rtl}),i.css("display","none"),this._createButton("filter",p),this._createButton("clear",w),r=="number"?u.ejNumericTextbox({cssClass:this.model.cssClass,rtl:this.model.rtl,value:0,showSpinButton:!1,height:"26px",decimal:2}):r=="date"?u.ejDatePicker({cssClass:this.model.cssClass,rtl:this.model.rtl,width:230}):r=="boolean"?y.ejCheckBox({cssClass:this.model.cssClass,rtl:this.model.rtl}):r=="string"&&(u.attr("id",this._id+"_acString"),u.ejAutocomplete({cssClass:this.model.cssClass,rtl:this.model.rtl,dataSource:this.model.dataSource,width:230,height:26,distinct:!0}))},_createButton:function(n,i){var r=n=="filter"?t.proxy(this._fltrBtnHandler,this):t.proxy(this._fltrClrHandler,this);i.ejButton({cssClass:this.model.cssClass,rtl:this.model.rtl,click:r})},_fltrBtnHandler:function(){var u=n("#"+this._id+"_"+this._$colType+"Dlg"),r=u.find(".value input"),f,t=r.val(),e=i;this._$colType=="number"&&(t=parseFloat(r.ejNumericTextbox("getValue")),e=!0),this._$colType=="string"&&(e=u.find(".predicate input[type='checkbox']").is(":checked")),this._$colType=="date"&&(t=Globalize.parseDate(t,this._$colFormat)),this._$colType=="boolean"?(t=r.ejCheckBox("model.checked")!=null?r.ejCheckBox("model.checked"):!1,f="equal"):f=n("#"+this._id+this._$colType+"_ddinput").ejDropDownList("getSelectedItem").toLowerCase(),this.sendFilteringRequest(this._$curFieldName,f,t,u.find(".predicate input[type='radio']:checked").attr("value"),e)},_fltrClrHandler:function(){var t="#"+this._id+"_"+this._$colType+"Dlg";this._$colType=="boolean"?n(t).find(".value input").ejCheckBox("model.checked",!1):n(t).find(".value input").val(""),this.sendFilteringRequest(this._$curFieldName,"","","or")},_processEditing:function(){var i=this._columnToSelect(),n;this.model.dataSource instanceof t.DataManager&&i.queries.length?(n=this.model.dataSource.executeQuery(this._columnToSelect()),n.done(t.proxy(function(n){this._dropDownManager=t.DataManager(n.result),this.model.edit.editMode=="dialog"?this.addDialogEditingTemplate():this.model.edit.editMode=="dialogTemplate"?this.addExternalDialogEditingTemplate():this.addEditingTemplate()},this))):this.model.edit.editMode=="dialog"?this.addDialogEditingTemplate():this.model.edit.editMode=="dialogTemplate"?this.addExternalDialogEditingTemplate():this.addEditingTemplate()},_initGridRender:function(){this.addInitTemplate(),this.model.allowGrouping&&this.addGroupingTemplate(),this.renderGrid(),this.model.allowGrouping&&this._headerCellgDragDrop(),this.model.allowReordering&&(this._headerCellreorderDragDrop(),this._initIndicators()),this._wireEvents(),this.model.allowResizing&&(this._resizer=new gridResize(this)),this._initialRender=!1,this.model.width&&!this.model.allowScrolling&&this.element.width(this.model.width)},_checkSkipAction:function(n){switch(n.requestType){case t.Grid.actions.Save:case t.Grid.actions.Delete:return!0}return!1},_processBindings:function(n){if(this.model.query=new t.Query,!this._checkSkipAction(n)&&this._trigger("actionBegin",n))return!0;if(this._ensureDataSource(n),n.requestType==t.Grid.actions.Delete&&this.model.groupSettings.groupedColumns.length==0&&n.tr.remove(),this.model.dataSource instanceof t.DataManager&&n.requestType!=t.Grid.actions.BeginEdit&&n.requestType!=t.Grid.actions.Cancel&&n.requestType!=t.Grid.actions.Add){var i=this.model.dataSource.executeQuery(this.model.query),r=this.element.ejWaitingPopup("instance");this.element.ejWaitingPopup("show"),i.done(t.proxy(function(i){this.element.ejWaitingPopup("hide"),this.model.currentViewData=i.result,this._totalRecordsCount=i.count==0&&i.result.length?i.result.length:i.count,n.requestType==t.Grid.actions.Filtering&&(this._filteredRecordsCount=i.count),this.sendDataRenderingRequest(n)},this))}else this.sendDataRenderingRequest(n)},_initPrivateProperties:function(){this._gridHeaderTable=null,this._gridWidth=this.element.width(),this._id=this.element.attr("id"),this._gridRows=null,this._gridContentTable=null,this._totalRecordsCount=this.model.dataSource!==null?this.model.dataSource.length:0,this._links=null,this._gridPager=null,this._cSortedColumn=null,this._cSortedDirection=null,this._$curSElementTarget=null,this._gridFilterBar=null,this._$curFieldName=null,this._$prevFieldName=null,this._$fDlgIsOpen=!1,this._$colType=null,this._$colFormat=null,this._$prevColType=null,this._$prevSElementTarget=null,this._currentFilterColumn=null,this._filterCollection=[],this._filteredRecordsCount=null,this._filteredRecords=[],this.filterColumnCollection=[],this._primaryKeys=[],this._primaryKeyValues=[],this._modifiedRecords=[],this._addedRecords=[],this._tdsOffsetWidth=[],this._deletedRecords=[],this._disabledToolItems=n(),this._validationRules={},this._groupedColumns=[],this._currentJsonData=[],this._groupingColumnIndex=0,this._dataManager=this.model.dataSource instanceof t.DataManager?this.model.dataSource:this.model.dataSource!=null?t.DataManager(this.model.dataSource):null,this._disabledSortableColumns=[],this._disabledGroupableColumns=[],this._disabledFilterableColumns=[],this._hiddenColumns=[],this._visibleColumns=[],this._sortedColumns=[],this._multiSortRequest=!1,this._multiSelectCtrlRequest=!1,this._multiSelectShiftRequest=!1,this._initialRender=!1,this._fieldColumnNames={},this._headerColumnNames={},this._selectedRowsIndexes=[],this._isReorder=!1,this._searchString="",this._searchCount=null,this._columnsWidthCollection=[],this._Indicator=null,this._resizer=null},addInitTemplate:function(){var s,o,u,r,h,l,f,a,e,c;if(this.model.columns.length!==0){if(s=document.createElement("tbody"),this.model.rowTemplate!=null)n(s).append(n(this.model.rowTemplate).html());else{for(o=document.createElement("tr"),u=this.model.columns,this._totalRecordsCount&&this._getColumnTypes(this.model.currentViewData[0]!=i?this.model.currentViewData[0]:this.model.currentViewData.value),h={_gridFormatting:this.formatting},n.views.helpers(h),this.model.detailTemplate&&(l=t.buildTag("td.detailrowcollapse","<div><\/div>"),n(o).append(l)),r=0;r<this.model.columns.length;r++){if(f=t.buildTag("td.rowcell"),u[r].visible==!1&&f.addClass("hide"),this.model.groupSettings.groupedColumnShow||f.addClass("{{for ~groupedColumns}} {{if #data == '"+this.model.columns[r].field+"'}}hide{{/if}}{{/for}}"),u[r].columnTemplate)e={},e["_"+this._id+"ColumnTemplating"]=this._gridTemplate,n.views.helpers(e),n("#"+this._id+u[r].headerText+"_Template").remove(),a=this._createTemplateElement(u[r]),this.model.columns[r].allowGrouping=this.model.columns[r].allowFiltering=this.model.columns[r].allowSorting=!1,f.addClass("templatecell").html("{{:~_"+this._id+"ColumnTemplating('"+a.id+"')}}");else{switch(u[r].type){case"boolean":f.addClass("boolrowcell").html("{{if "+u[r].field+'}} <input type ="checkbox" disabled="disabled" checked="checked"><\/input>{{else}} <input type ="checkbox" disabled="disabled"  ><\/input> {{/if}}');break;default:f.html("{{:"+u[r].field+"}}")}u[r].format!=i&&f.html("{{:~_gridFormatting('"+u[r].format+"',"+u[r].field+",'"+u[r].field+"')}}"),u[r].isUnBound&&(e={},e["_"+this._id+"UnboundTemplate"]=this._unboundTemplateRendering,n.views.helpers(e),this.model.columns[r].allowGrouping=this.model.columns[r].allowFiltering=this.model.columns[r].allowSorting=!1,n("#"+this._id+u[r].headerText+"_UnboundTemplate").remove(),divElement=this._createUnboundElement(u[r]),f.addClass("unboundcell").addClass(u[r].headerText.replace(/\s+/g,"")).html("{{:~_"+this._id+"UnboundTemplate('"+divElement.id+"')}}"),this._isUnboundColumn=!0)}u[r].textAlign!=i&&f.css("text-align",u[r].textAlign),t.isNullOrUndefined(u[r].customAttributes)||f.attr(u[r].customAttributes),n(o).append(f),this.model.altRow&&(h["_"+this._id+"AlternateRow"]=this._alternateRow,n.views.helpers(h),n(o).addClass("{{:~_"+this._id+"AlternateRow()}}"))}s.appendChild(o)}c={},c[this._id+"_JSONTemplate"]=n(s).html(),n.templates(c)}},_createTemplateElement:function(t){var i=document.createElement("script");return i.id=(this._id+t.headerText+"_Template").split(" ").join(""),i.type="text/x-jsrender",i.text=n(t.templateId).html(),n("body").append(i),n(t.templateId).hide(),i},_createUnboundElement:function(i){var f=document.createElement("div"),e,u,r,o;for(f.id=this._id+i.headerText.replace(/\s+/g,"")+"_UnboundTemplate",e=t.buildTag("div.unboundcelldiv"),u=i.commands,r=0;r<u.length;r++)o=t.buildTag("input."+u[r].type+"button","",{},{type:"button"}),o.val(u[r].type),e.append(o);return n("body").append(n(f).html(e).hide()),f},addGroupingTemplate:function(){var c=document.createElement("tbody"),i=this,r={};r["_"+i._id+"ColSpanAdjust"]=this._colSpanAdjust,r["_"+i._id+"Colgroup"]=this._getColGroup,r["_"+i._id+"CaptionFormat"]=this._captionFormat,r[i._id+"Object"]=this,n.views.helpers(r);var f="<td class='recordplusexpand'><div><\/div><\/td><td class='groupcaption' colspan='{{:~_"+i._id+"ColSpanAdjust('"+i._id+"Object','groupcaption') }}'>{{:~_"+i._id+"CaptionFormat('"+i._id+"Object')}}<\/td",e="<tr>"+f+"<\/tr>",u=t.buildTag("tbody");u.html("{{if items.GROUPGUID}}{{for items tmpl='"+i._id+"_GroupingTemplate'/}}{{else}}{{for items tmpl='"+i._id+"_JSONTemplate'/}}{{/if}}");var o="<table class='table {{if items.GROUPGUID}}{{else}}recordtable{{/if}}' cellspacing='0.25px' >{{:~_"+i._id+"Colgroup('"+i._id+"Object')}}"+u.html()+"<\/table>",s="<td class='tabletd' colspan='{{:~_"+i._id+"ColSpanAdjust('"+i._id+"Object','table')}}'>"+o+"<\/td>",h="<tr><td class='indentcell'><\/td>"+s+"<\/tr>";n.templates(i._id+"_GroupingTemplate",e+h)},_captionFormat:function(n){var t=this.getRsc("helpers",n),i=t.getColumnByField(this.data.field);return i.headerText+": "+this.data.key+" - "+this.data.count+" "+t._getLocalizedLabels("GroupCaptionFormat")},_alternateRow:function(){return this.getIndex()%2==0?"":"alt_row"},_getColGroup:function(t){var r=this.getRsc("helpers",t),u,f,e;return u=r.model.groupSettings.groupedColumns.length==1?this.data.items.level===i?0:this.data.items.level-1:this.data.items.level===i?r.model.groupSettings.groupedColumns.length:this.data.items.level-1,f=n(document.createElement("div")),e=r._getMetaColGroup(),u!=r.model.groupSettings.groupedColumns.length&&r.model.groupSettings.groupedColumns.length>1&&e.prepend(r._getIndentCol()),f.html(e),f.html()},_colSpanAdjust:function(n,t){var r=this.getRsc("helpers",n),u,e,f;return r.model.groupSettings.groupedColumns.length==1?(u=this.data.items.level===i?1:this.data.items.level-1,t=="groupcaption"&&(r._currentJsonData=r._currentJsonData.concat(this.data.items))):(u=this.data.items.level===i?r.model.groupSettings.groupedColumns.length:this.data.items.level-1,t=="groupcaption"&&this.data.items.level===i&&(r._currentJsonData=r._currentJsonData.concat(this.data.items))),e=r.model.groupSettings.groupedColumnShow?0:r.model.groupSettings.groupedColumns.length,f=r.model.columns.length+r.model.groupSettings.groupedColumns.length-u-r._hiddenColumns.length-e,r.model.detailTemplate!=null?f+1:f},_gridTemplate:function(t){return n("#"+t).render(this.data)},_unboundTemplateRendering:function(t){return n("#"+t).html()},_compiledDropDownTemplate:function(){var i=t.buildTag("select"),r=t.buildTag("option","{{:text}}",{},{value:"{{:value}}"});return i.append(r),n.templates(i.html())},addEditingTemplate:function(){var l,d,r,u,a,g,nt,tt,v,s,e,o,it,f,h;if(this.model.columns.length!=0){var y=t.buildTag("tbody"),p=t.buildTag("tr"),w=t.buildTag("td","",{},{colSpan:this.model.columns.length}),b=t.buildTag("form","",{},{id:this._id+"EditForm"}),c=t.buildTag("table.table","",{},{cellspacing:.25}),rt=t.buildTag("tbody"),k=t.buildTag("tr");for(y.append(p),p.append(w),w.append(b),l=n(document.createElement("colgroup")),b.append(c),c.append(l),rt.append(k).appendTo(c),d=this._compiledDropDownTemplate(),r=0;r<this.model.columns.length;r++){if(u=t.buildTag("td.rowcell"),k.append(u.get(0)),t.isNullOrUndefined(this.model.columns[r].isUnBound)&&t.isNullOrUndefined(this.model.columns[r].columnTemplate)){a=t.Grid.editingType.StringEdit,this.model.columns[r].columnEditType!=i&&(a=this.model.columns[r].columnEditType);switch(a){case"stringedit":u.html(t.buildTag("input.field ejinputtext","",{},{value:"{{:"+this.model.columns[r].field+"}}",id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}));break;case"booleanedit":u.html("{{if "+this.model.columns[r].field+'}} <input class="field checkbox" type ="checkbox" id='+this._id+this.model.columns[r].field+" name="+this.model.columns[r].field+' checked="checked"><\/input>{{else}} <input class="field checkbox" type ="checkbox" id='+this._id+this.model.columns[r].field+" name="+this.model.columns[r].field+" > {{/if}}");break;case"numericedit":g=t.buildTag("input.numerictextbox field","",{},{type:"text",value:"{{:"+this.model.columns[r].field+"}}",id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}),u.append(g);break;case"datepicker":nt=t.buildTag("input.datepicker field","",{},{type:"text",value:"{{:"+this.model.columns[r].field+"}}",id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}),u.append(nt);break;case"dropdownedit":if(t.isNullOrUndefined(this.model.columns[r].dropdownData))for(v=(new t.Query).select(this.model.columns[r].field),tt=t.isNullOrUndefined(this._dropDownManager)?this._dataManager.executeLocal(v):this._dropDownManager.executeLocal(v),s=[],e=e=t.dataUtil.mergeSort(t.distinct(tt)),o=0;o<e.length;o++)s.push({text:e[o],value:e[o]});else s=this.model.columns[r].dropdownData;u.get(0).innerHTML=["<select>",d.render(s),"<\/select>"].join(""),u.find("select").prop({id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}).addClass("field dropdownlist")}}else this.model.columns[r].columnTemplate?(f={},f["_"+this._id+"ColumnTemplating"]=this._gridTemplate,n.views.helpers(f),n("#"+this._id+this.model.columns[r].headerText+"_Template").remove(),it=this._createTemplateElement(this.model.columns[r]),u.addClass("templatecell").html("{{:~_"+this._id+"ColumnTemplating('"+it.id+"')}}")):this.model.columns[r].isUnBound&&(f={},f["_"+this._id+"UnboundTemplate"]=this._unboundTemplateRendering,n.views.helpers(f),n("#"+this._id+this.model.columns[r].headerText+"_UnboundTemplate").remove(),divElement=this._createUnboundElement(this.model.columns[r]),u.addClass("unboundcell").addClass(this.model.columns[r].headerText.replace(/\s+/g,"")).html("{{:~_"+this._id+"UnboundTemplate('"+divElement.id+"')}}"),this._isUnboundColumn=!0);this.model.columns[r].textAlign!=i&&u.css("text-align",this.model.columns[r].textAlign),this.model.columns[r].allowEditing==!1&&u.find(".field").attr("disabled",!0),this.model.columns[r].key===!0&&(u.find(".field").attr("disabled",!0),this._primaryKeys.push(n.trim(this.model.columns[r].field)),this._primaryKeys=n.unique(this._primaryKeys)),this.model.columns[r].isIdentity===!0&&u.find(".field").addClass("identity"),h=n(document.createElement("col")),this.model.columns[r].visible===!1&&(h.css("display","none"),u.addClass("hide")),!this.model.groupSettings.groupedColumnShow&&u.addClass("{{for ~groupedColumns}} {{if #data == '"+this.model.columns[r].field+"'}}hide{{/if}}{{/for}}")&&h.css("display","none"),l.append(h)}n.templates(this._id+"_JSONEditingTemplate",y.html())}},addDialogEditingTemplate:function(){var r,a,p,w,b,v,h,f,e;if(this.model.columns.length!=0){var o=t.buildTag("div"),s=t.buildTag("form","",{},{id:this._id+"EditForm"}),c=t.buildTag("table","",{},{cellspacing:"14px"}),k=this._compiledDropDownTemplate();for(r=0;r<this.model.columns.length;r++){var l=t.buildTag("tr"),y=t.buildTag("td","",{"text-align":"right"}),u=t.buildTag("td","",{"text-align":"left"}).addClass("rowcell");l.append(y.get(0)).append(u.get(0)),a=t.Grid.editingType.StringEdit,this.model.columns[r].columnEditType!=i&&(a=this.model.columns[r].columnEditType),this.model.columns[r].headerText==i&&(this.model.columns[r].headerText=this.model.columns[r].field),y.append("<label for='"+this.model.columns[r].field+"'>"+this.model.columns[r].headerText+"<\/label>");switch(a){case"stringedit":u.html(t.buildTag("input.field ejinputtext","",{},{value:"{{:"+this.model.columns[r].field+"}}",id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}));break;case"booleanedit":u.html("{{if "+this.model.columns[r].field+'}} <input class="field" type ="checkbox" id='+this._id+this.model.columns[r].field+" name="+this.model.columns[r].field+' checked="checked"><\/input>{{else}} <input class="field" type ="checkbox" id='+this._id+this.model.columns[r].field+" name="+this.model.columns[r].field+" > {{/if}}");break;case"numericedit":p=t.buildTag("input.numerictextbox field","",{},{type:"text",value:"{{:"+this.model.columns[r].field+"}}",id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}),u.append(p);break;case"datepicker":w=t.buildTag("input.datepicker field","",{},{type:"text",value:"{{:"+this.model.columns[r].field+"}}",id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}),u.append(w);break;case"dropdownedit":if(t.isNullOrUndefined(this.model.columns[r].dropdownData))for(v=(new t.Query).select(this.model.columns[r].field),b=t.isNullOrUndefined(this._dropDownManager)?this._dataManager.executeLocal(v):this._dropDownManager.executeLocal(v),h=[],f=f=t.dataUtil.mergeSort(t.distinct(b)),e=0;e<f.length;e++)h.push({text:f[e],value:f[e]});else h=this.model.columns[r].dropdownData;u.get(0).innerHTML=["<select>",k.render(h),"<\/select>"].join(""),u.find("select").prop({id:this._id+this.model.columns[r].field,name:this.model.columns[r].field}).addClass("field dropdownlist")}this.model.columns[r].key===!0&&u.find(".field").attr("disabled",!0),this.model.columns[r].visible===!1&&l.addClass("hide"),s.append(c),c.append(l),s.appendTo(o),this.model.columns[r].key===!0&&(u.find(".field").attr("disabled",!0),this._primaryKeys.push(n.trim(this.model.columns[r].field)),this._primaryKeys=n.unique(this._primaryKeys))}s.append(c),o=this.renderDiaglogButton(s,o),n.templates(this._id+"_JSONDialogEditingTemplate",o.html())}},renderDiaglogButton:function(n,i){var f=t.buildTag("input","",{"margin-left":"20px"},{type:"button",id:"EditDialog_"+this._id+"_Save"}),u,r;return f.ejButton({cssClass:this.model.cssClass,rtl:this.model.rtl,text:this._getLocalizedLabels("SaveButton"),width:"100"}),u=t.buildTag("input","",{"margin-left":"20px"},{type:"button",id:"EditDialog_"+this._id+"_Cancel"}),u.ejButton({cssClass:this.model.cssClass,rtl:this.model.rtl,text:this._getLocalizedLabels("CancelButton"),width:"100"}),r=t.buildTag("div"),r.append(f),r.append(u).css("padding-bottom","10px"),n.append(r),n.appendTo(i),i},addExternalDialogEditingTemplate:function(){var i,r,u;if(this.model.columns.length!=0){for(i=0;i<this.model.columns.length;i++)this.model.columns[i].key===!0&&(this._primaryKeys.push(n.trim(this.model.columns[i].field)),this._primaryKeys=n.unique(this._primaryKeys));r=t.buildTag("div","",{display:"none"}),u=t.buildTag("form","",{},{id:this._id+"EditForm"}),u.append(n(this.model.edit.dialogEditorTemplateId).clone().show()),r=this.renderDiaglogButton(u,r),u.appendTo(r),n.templates(this._id+"_JSONdialogTemplateMode",r.html())}},_buttonClick:function(t){if(t.keyCode!==i&&t.keyCode!=13)return!0;t.target.id=="EditDialog_"+this._id+"_Save"?n("#"+this._id).ejGrid("sendSaveRequest").length!==i&&n("#"+this._id+"_dialogEdit").ejDialog("close"):t.target.id=="EditDialog_"+this._id+"_Cancel"?(n("#"+this._id).ejGrid("sendCancelRequest"),n("#"+this._id+"_dialogEdit").ejDialog("close")):n("#"+this._id).ejGrid("sendCancelRequest")},_headerCellgDragDrop:function(){var i=this,r;this.dragHeaderElement(),r=this.element.children("div.groupdroparea"),r.ejDroppable({accept:r,drop:function(r,u){if(!t.isNullOrUndefined(u.helper)&&u.helper.is(":visible")){var f=i.getColumnByHeaderText(n.trim(u.helper.text()));(u.helper.remove(),n.inArray(f.headerText,i._disabledGroupableColumns)==-1)&&(t.isNullOrUndefined(f.field)||i.sendGroupingRequest(f.field))}}})},_headerCellreorderDragDrop:function(){var i=this,r;this.dragHeaderElement(),r=this.element.find(".headercelldiv"),r.ejDroppable({accept:r,drop:function(r,u){var f,e;!t.isNullOrUndefined(u.helper)&&u.helper.is(":visible")&&(f=i.getColumnByHeaderText(n.trim(u.helper.text())),u.helper.remove(),n.inArray(f.headerText,i._disabledGroupableColumns)==-1)&&(t.isNullOrUndefined(f.field)||(e=i.getColumnByHeaderText(n.trim(n(r.originalEvent.target).text())),i.sendReorderingRequest(f.field,e.field)))}})},dragHeaderElement:function(){var i=this,r=this.element.children("div.gridheader").find("th.headercell").not(".headertemplate"),u=t.buildTag("div.e-grid-metro cloneproperties e-grid-core","",{height:"20px","z-index":2});r.ejDraggable({helper:function(t){i.element.find(".dragclone").length>0&&i.element.find(".dragclone").remove();var r=n(t.sender.target).hasClass("headercell")?n(t.sender.target):n(t.sender.target).closest("th");return u.html(r.text()).clone().width(r.outerWidth()+2).height(r.height()+2).css({"font-size":parseInt((r.height()+3)/2)}).addClass("dragclone").appendTo(i.element)},dragStart:function(t){var r=t.event.originalEvent.target,u={target:r,draggableType:"headercell"},f;return i._resizer!=null&&i._resizer._expand?(n(".dragclone").remove(),!1):(i._dragActive=!0,f=i.element.find(".groupdroparea"),i.expandGroupDropArea(),i._trigger("dragStart",u)?!1:void 0)},drag:function(t){var r=n(t.event.originalEvent.target),u={target:r,draggableType:"headercell"};if(i._trigger("drag",u))return!1;r.hasClass("headercelldiv")&&i.model.allowReordering&&(document.body.style.cursor="",r.addClass("allowDrop"),i.getGridHeaderTable().find(".reorderindicate").removeClass("reorderindicate"),r.parent().addClass("reorderindicate")),r.hasClass(".groupdroparea")||r.closest(".groupdroparea").length?(document.body.style.cursor="",r.addClass("allowDrop")):document.body.style.cursor="not-allowed"},dragStop:function(t){var u,r;t.element.dropped||(r=n(t.event.originalEvent.target),u={target:r,draggableType:"headercell"},i._trigger("dragStop",u),i.element.find(".groupdroparea").removeClass("groupdropareahover"),i.getGridHeaderTable().find(".columnheader").find(".headercellactive").removeClass("headercellactive"),n(".dragclone").remove(),i._dragActive=!1,r=i.element.find(".groupdroparea"),i.getGridHeaderTable().find(".reorderindicate").removeClass("reorderindicate"),i.collapseGroupDropArea(),document.body.style.cursor="",n(i._Indicator).css("display","none"))}})},_initIndicators:function(){var t=this._id+"_ColumnDropIndicator";n("#"+t).length&&n("#"+t).remove(),this._Indicator=document.createElement("DIV"),n(this._Indicator).attr("id",t).addClass("columndropindicator").addClass("dropAcceptor").appendTo(document.body),n(this._Indicator).css({display:"none"})},_showImg:function(t){if(this._locationHelper(t),cell=t.target.tagName=="DIV"&&t.target.parentNode.tagName=="TH"?t.target.parentNode:t.target.tagName=="TH"?t.target:null,cell.cellIndex>=0){var i=n(cell).offset(),r=navigator.userAgent.search("Mozilla")>=0&&this._groupedColumns.length>0?3:4,u=navigator.userAgent.search("Mozilla")>=0&&this._groupedColumns.length>0?2:1;n(this._Indicator).css("left",parseInt(i.left-r)).css("position","absolute").css("top",parseInt(i.top+u)).css("display","").css("z-index",this._maxZindex()+1)}},_maxZindex:function(){var t=1;return t=Math.max.apply(null,n.map(n("body *"),function(t){if(n(t).css("position")=="absolute")return parseInt(n(t).css("z-index"))||1})),(t==i||t==null)&&(t=1),t},_locationHelper:function(n){this._x=document.all?n.clientX:document.layers?n.x:n.clientX,this._y=document.all?n.clientY:document.layers?n.y:n.clientY},set_dropColumn:function(i,r){var f,u,e;for(this.model.columns.splice(r,0,this.model.columns.splice(i,1)[0]),f=this.model.columns,this._fieldColumnNames=this._headerColumnNames=[],u=0;u<f.length;u++)this._fieldColumnNames[f[u].headerText]=f[u].field,this._headerColumnNames[f[u].field]=f[u].headerText,n(this.getGridHeaderTable().find(".headercell >div.headercelldiv")[u]).text(f[u].headerText);e={},e.requestType=t.Grid.actions.Reorder,this.addInitTemplate(),this.sendDataRenderingRequest(e)},_groupHeaderCelldrag:function(){var u=t.buildTag("div.e-grid-metro cloneproperties e-grid-core","",{height:"20px","z-index":2}),i=this,f=this.element.children(".groupdroparea").find(".groupheadercell"),r;f.ejDraggable({helper:function(t){var r=n(t.sender.target).closest(".grid-icon");return u.html(n(t.sender.target).closest(".groupheadercell").text()).clone().width(r.width()+2).height(r.height()+2).addClass("dragclone").appendTo(i.element)},dragStart:function(n){var t=n.event.originalEvent.target,r={target:t,draggableType:"groupheadercell"};if(i._trigger("dragStart",r))return!1},drag:function(t){n(".Sibling").remove();var r=n(t.event.originalEvent.target),u={target:r,draggableType:"groupheadercell"};if(i._trigger("drag",u))return!1;r.closest("div.gridcontent").length?(document.body.style.cursor="",r.addClass("allowDrop")):document.body.style.cursor="not-allowed"},dragStop:function(t){if(!t.element.dropped){var r=n(t.event.originalEvent.target),u={target:r,draggableType:"groupheadercell"};i._trigger("dragStop",u),n(".dragclone").remove(),document.body.style.cursor=""}}}),r=this.element.children(".gridcontent"),r.ejDroppable({accept:i.element.children("div.groupdroparea").find(".groupheadercell"),drop:function(r,u){if(!t.isNullOrUndefined(u.helper)&&u.helper.is(":visible")&&u.draggable.hasClass("groupheadercell")){var f=i.getFieldNameByHeaderText(n.trim(u.helper.text()));u.helper.remove(),t.isNullOrUndefined(f)||i.sendUngroupingRequest(f)}}})},renderGrid:function(){this._renderGridContent().insertAfter(this.element.children(".gridheader")),this.model.allowGrouping&&this._groupHeaderCelldrag(),this.model.allowSummary=this.model.summaryRows.length>0||this.model.allowSummary,this.model.allowSummary&&this._renderGridFooter().insertAfter(this.element.children(".gridcontent")),(this.model.edit.allowEditing||this.model.edit.allowAdding)&&(this.model.edit.editMode=="dialog"||this.model.edit.editMode=="dialogTemplate")&&this.element.append(this._renderDialog()),this._initialEndRendering(),this.model.allowFiltering&&this.model.filterSettings.showFilterBarMessage&&this._createStatusBar(),this.model.allowScrolling&&this._renderScroller()},_renderGroupDropArea:function(){this.model.groupSettings.showAnimateButton||(this.model.enableEffects=this.model.groupSettings.showAnimateButton);var i=this.model.enableEffects?"":this._getLocalizedLabels("GroupDropArea"),n=t.buildTag("div.groupdroparea",i);return this.model.groupSettings.showAnimateButton&&n.append(t.buildTag("div.animatebutton").addClass(this.model.enableEffects?"animatebuttondown":"animatebuttonup")),n},_renderToolBar:function(){var r=t.buildTag("div.gridtoolbar","",{},{id:this._id+"_toolbarItems"}),f=t.buildTag("ul"),u,i;return!t.isNullOrUndefined(this.model.toolBar.toolBarItems)&&this.model.toolBar.toolBarItems.length&&this._renderLi(f),r.append(f),u=t.buildTag("ul"),r.append(u),!t.isNullOrUndefined(this.model.toolBar.customToolbarItems)&&this.model.toolBar.customToolbarItems.length&&this._renderCustomLi(u),i={},i.click=this._toolBarClick,i.cssClass=this.model.cssClass,i.rtl=this.model.rtl,i.itemSeparator=!1,r.ejToolbar(i),r.ejToolbar("disableItem",this._disabledToolItems),this._disabledToolItems=n(),r},_renderCustomLi:function(i){for(var u,f,r=0;r<this.model.toolBar.customToolbarItems.length;r++){u=t.buildTag("li","",{},{title:this.model.toolBar.customToolbarItems[r]});switch(typeof this.model.toolBar.customToolbarItems[r]){case"string":f=t.buildTag("a.toolbaricons","",{}).addClass(this.model.toolBar.customToolbarItems[r]);break;case"object":u.attr("title",this.model.toolBar.customToolbarItems[r].templateId.replace("#","")),f=n(this.model.toolBar.customToolbarItems[r].templateId).hide().html()}u.html(f),i.append(u)}},_renderLi:function(n){for(var r,i=0;i<this.model.toolBar.toolBarItems.length;i++)r=t.buildTag("li","",{},{id:this._id+"_"+this.model.toolBar.toolBarItems[i],title:this.model.toolBar.toolBarItems[i]}),this._renderLiContent(r,this.model.toolBar.toolBarItems[i]),n.append(r)},_renderLiContent:function(n,i){var r,u;switch(i){case"add":r=t.buildTag("a.addnewitem toolbaricons","",{});break;case"edit":r=t.buildTag("a.edititem toolbaricons","",{});break;case"delete":r=t.buildTag("a.deleteitem toolbaricons","",{});break;case"update":r=t.buildTag("a.saveitem toolbaricons disabletool","",{}),this._disabledToolItems.push(n.get(0));break;case"cancel":r=t.buildTag("a.cancel toolbaricons disabletool","",{}),this._disabledToolItems.push(n.get(0));break;case"search":u=t.buildTag("input.ejinputtext","",{},{type:"text"}),r=t.buildTag("a.searchitem toolbaricons disabletool","",{}),n.append(u),this.model.allowSearching=!0}n.append(r)},_renderGridHeader:function(){var f,e,r,l,p;if(this.model.columns.length==0)throw"column collection is missing";f=t.buildTag("div.gridheader"),e=t.buildTag("div"),this.model.allowScrolling&&(e.addClass("headercontent"),f.addClass("scrollcss"));var s=t.buildTag("table.table","",{},{cellspacing:"0.25px"}),a=t.buildTag("thead"),v=t.buildTag("tbody.hide"),h=t.buildTag("tr.columnheader"),c=n(document.createElement("colgroup")),y=n(document.createElement("tr"));for(this._hiddenColumns=[],this.model.detailTemplate&&(h.append(t.buildTag("th.headercell detailheadercell","<div><\/div>")),c.append(this._getIndentCol())),r=0;r<this.model.columns.length;r++){var u=t.buildTag("th.headercell"),w=document.createElement("td"),o=t.buildTag("div.headercelldiv",this.model.columns[r].headerText==i?this.model.columns[r].headerText=this.model.columns[r].field:this.model.columns[r].headerText);u.append(o),this.model.allowFiltering&&this.model.filterSettings.filterType=="menu"&&u.append(t.buildTag("div.filtericon")),l=document.createElement("col"),y.append(w),h.append(u),c.append(l),this.model.columns[r].visible===!1?u.addClass("hide")&&n(l).css("display","none")&&this._hiddenColumns.push(this.model.columns[r].headerText):this._visibleColumns.push(this.model.columns[r].headerText),this.model.columns[r].allowSorting===!1&&this._disabledSortableColumns.push(this.model.columns[r].headerText),this.model.columns[r].allowGrouping===!1&&this._disabledGroupableColumns.push(this.model.columns[r].headerText),t.isNullOrUndefined(this.model.columns[r].headerTemplateId)||(o.html(n(this.model.columns[r].headerTemplateId).hide().html()).parent().addClass("headertemplate"),p=n.inArray(this.model.columns[r].headerText,this._disabledGroupableColumns),p==-1&&this._disabledGroupableColumns.push(this.model.columns[r].headerText)),this.model.groupSettings.toggleGrouping&&n.inArray(this.model.columns[r].headerText,this._disabledGroupableColumns)==-1&&(n.inArray(this.model.columns[r].field,this.model.groupSettings.groupedColumns)!=-1?o.append(this._getToggleButton().addClass("toggleungroup")):o.append(this._getToggleButton().addClass("togglegroup"))),this._columnsWidthCollection.push(this.model.columns[r].width),this.model.columns[r].width==i&&this.model.commonWidth!==i&&(this._columnsWidthCollection[r]=this.model.commonWidth),this._fieldColumnNames[this.model.columns[r].headerText]=this.model.columns[r].field,this._headerColumnNames[this.model.columns[r].field]=this.model.columns[r].headerText,this.model.allowFiltering&&t.Grid.filterType.Menu==this.model.filterSettings.filterType&&u.addClass("headercellfilter")}return a.append(h),v.append(y),s.append(c).append(a).append(v),e.html(s),f.html(e),this.setGridHeaderTable(s),f},_renderGridFooter:function(){if(this.model.summaryRows.length>0){var i=t.buildTag("div.gridfooter"),n=t.buildTag("table#"+this._id+"_summaryTable.gridsummary","",{},{cellspacing:"0.25px"});return n.append(this.getGridHeaderTable().find("colgroup").clone()),this._createSummaryRows(n),i.append(n),i}throw"summary row collection is missing";},_createSummaryRows:function(i){i.find("tbody").length>0&&i.find("tbody").remove();var u=t.buildTag("tbody"),r=this;n.each(this.model.summaryRows,function(i,f){var o=t.buildTag("tr"),e=r.getGridHeaderTable().find("td").clone().addClass("summaryrow");e.first().html(f.title),o.append(e),u.append(o),n.each(f.summaryColumns,function(t,i){var u=r._getSummaryValues(i),o=i.prefix?i.prefix:"",f=r.getColumnIndexByField(i.displayColumn),s=i.suffix?i.suffix:"";n(e[f]).html(o+(i.format?r.formatting(i.format,u):u)+s).css("text-align",r.model.columns[f].textAlign)})}),i.append(u)},_getSummaryValues:function(n){var i,r,e,u,f;r=this._filterCollection.length>0?this._filteredRecords:this.model.dataSource,e=r instanceof t.DataManager?r:t.DataManager(r);switch(n.summaryType){case t.Grid.summaryType.Maximum:u=t.max(r,n.dataMember),i=u[n.dataMember];break;case t.Grid.summaryType.Minimum:u=t.min(r,n.dataMember),i=u[n.dataMember];break;case t.Grid.summaryType.Average:i=t.avg(r,n.dataMember);break;case t.Grid.summaryType.Sum:i=t.sum(r,n.dataMember);break;case t.Grid.summaryType.Count:i=r.length;break;case t.Grid.summaryType.TrueCount:f=t.Predicate(n.dataMember,"equal",!0),i=e.executeLocal(t.Query().where(f)).length;break;case t.Grid.summaryType.FalseCount:f=t.Predicate(n.dataMember,"equal",!1),i=e.executeLocal(t.Query().where(f)).length;break;case t.Grid.summaryType.Custom:i=n.customSummaryValue}return i},_renderDialog:function(){return t.buildTag("div.e-dialog e-dialog-content e-shadow e-widget-content","",{display:"none"},{id:this._id+"_dialogEdit"})},_renderGridContent:function(){var u=t.buildTag("div.gridcontent"),f=t.buildTag("div"),r=t.buildTag("table.table","",{},{cellspacing:"0.25px"}),e=n(document.createElement("tbody")),o,i;return r.append(this.getGridHeaderTable().find("colgroup").clone()).append(e),f.html(r),u.html(f),this.setGridContentTable(r),this.model.dataSource==null?(o=t.buildTag("td",this._getLocalizedLabels("EmptyRecord"),{},{colSpan:this.model.columns.length}),e.append(n(document.createElement("tr")).append(o))):(i={},this.model.groupSettings.groupedColumns.length?(this.model.groupSettings.groupedColumns.length&&this._initialRender&&(i.columnName=this.model.groupSettings.groupedColumns.lastItem()),i.requestType=t.Grid.actions.Grouping):i.requestType=t.Grid.actions.Refresh,this.sendDataRenderingRequest(i)),u},_renderScroller:function(){var t,i;this.model.scrolling||(this.model.scrolling={}),(this.model.scrolling.width||this.model.width)&&this.element.width(this.model.scrolling.width||this.model.width),t=this.element.children(".gridcontent").attr("tabindex","0"),t.ejScroller(this.model.scrolling),t.ejScroller("isVScroll")?this.element.find(".gridheader").addClass("scrollcss"):this.element.find(".gridheader").removeClass("scrollcss"),i=this,t.find(".content").scroll({gridObject:i},function(t){t.data.gridObject.element.children(".gridheader").find("div").first().scrollLeft(n(t.currentTarget).scrollLeft())}),this.element.find(".gridheader").find(".headercontent").scroll({gridObject:i},function(t){t.data.gridObject.element.children(".gridcontent").find(".content").first().scrollLeft(n(t.currentTarget).scrollLeft())})},_eventBindings:function(){if(this._refreshUnboundTemplate(this.getGridContentTable()),this._totalRecordsCount!=0&&(this.model.queryCellInfo!=null||this.model.rowDataBound!=null))for(var n=0;n<this._gridRows.length;n++)this._rowEventTrigger(this._gridRows[n],this.model.dataSource[n])},_rowEventTrigger:function(t,i){var u,e,r,f;for(this._trigger("rowDataBound",{Element:t,data:i}),u=t.cells,e=n(t).find(".rowcell"),r=0;r<u.length;r++)f={Element:u[r],Data:i,Text:u[r].innerHTML},n(u[r]).hasClass("rowcell")&&(f.column=this.model.columns[e.index(u[r])]),this._trigger("queryCellInfo",f)},_renderGridPager:function(){var t=n(document.createElement("div")),i={};return this.model.pageSettings.click=this._gPagerClickHandler,this.model.pageSettings.totalRecordsCount=this._totalRecordsCount,this.model.pageSettings.localization=this.model.localization,n.extend(i,this.model.pageSettings),i.masterObject=this,this.setGridPager(t),t.ejPager(i),t.ejPager("refreshPager"),this.model.pageSettings.totalPages=t.ejPager("model").totalPages,t},_renderFiltering:function(){var f=this.getGridHeaderTable(),i=t.buildTag("tr.filterbar"),n,r,u;for(this.model.detailTemplate&&i.append(t.buildTag("th.filterbarcell mastercell")),n=0;n<this.model.columns.length;n++)r=t.buildTag("input.ejinputtext","",{},{type:"text",id:this.model.columns[n].field+"_filterBarcell"}),u=t.buildTag("th.filterbarcell"),this.model.columns[n].allowFiltering===!1&&(r.attr("disabled",!0),this._disabledFilterableColumns.push(this.model.columns[n].headerText)),this.model.columns[n].visible===!1&&u.addClass("hide"),i.append(u.append(r));f.find("thead").append(i),this.setGridFilterBar(i)},_initialRenderings:function(){if(this.model.groupSettings.groupedColumns.length)for(var n=0;n<this.model.groupSettings.groupedColumns.length;n++)this.model.sortSettings.sortedColumns.push({field:this.model.groupSettings.groupedColumns[n],direction:t.sortOrder.Ascending})},_initialEndRendering:function(){this.model.selectedRow!=-1&&this.selectRows(this.model.selectedRow)},_createSortElement:function(){return t.buildTag("span","&nbsp;")},_createStatusBar:function(){var n=this.element.find(".e-grid-filterstatusbar");n.length&&n.remove();var i=this._gridWidth,r=i-this.model.filterSettings.statusBarWidth-2,u=t.buildTag("dihv.msgdiv");this.$statusBarDiv=t.buildTag("div.e-grid-filterstatusbar").addClass("status-right").append(u),this.$statusBarDiv.css({width:this.model.filterSettings.statusBarWidth+"px","margin-left":r+"px"}).appendTo(this.element)},_getColumnTypes:function(n){for(var t,r;n.items!=i;)n=n.items[0];for(t=0;t<this.model.columns.length;t++)r=n[this.model.columns[t].field],this.model.columns[t].type=r!=null?r.getDay?"date":typeof r:null},_findColumnsWidth:function(){var t=this.getGridHeaderTable().find("colgroup").find("col"),n;for(this.model.groupSettings.groupedColumns.length&&(t=t.slice(this.model.groupSettings.groupedColumns.length)),n=0;n<this.model.columns.length;n++)this._columnsWidthCollection[n]=t.eq(n).width()},_calculateWidth:function(){for(var t=this.getGridHeaderTable().find("colgroup").find("col"),i=0,n=0;n<t.length;n++)i+=t.eq(n).width();return i},_getEmptyTbody:function(){var i=t.buildTag("td",this._getLocalizedLabels("EmptyRecord"),{},{colSpan:this.model.columns.length});return n(document.createElement("tr")).append(i)},_getLocalizedLabels:function(n){return t.Grid.localization[this.model.localization][n]===i?t.Grid.localization["en-US"][n]:t.Grid.localization[this.model.localization][n]},_getToggleButton:function(){return t.buildTag("span.togglegroupbutton","&nbsp;")},_getRightHeaderCell:function(){return t.buildTag("th.rightheadercell")},_getGroupTopLeftCell:function(){var n=t.buildTag("th.grouptopleftcell");return n.append(t.buildTag("div.headercelldiv","&nbsp;")),n},_getIndentCol:function(){return t.buildTag("col","",{width:"30px"})},_getEmptyFilterBarCell:function(){return t.buildTag("th.filterbarcell")},_getMetaColGroup:function(){for(var u=t.buildTag("colgroup"),r,i=0;i<this.model.columns.length;i++)r=n(document.createElement("col")),this.model.columns[i].visible===!1&&r.css("display","none"),this.model.groupSettings.groupedColumnShow||n.inArray(this.model.columns[i].field,this.model.groupSettings.groupedColumns)==-1||r.css("display","none"),u.append(r);return u},_setoffsetWidth:function(){var i,t;if(this._totalRecordsCount!=0)for(i=n("#"+this._id+"EditForm").find("tr").find("td.rowcell").not(".unboundcell,.templatecell"),t=0;t<i.length;t++)this._tdsOffsetWidth[t]=i.get(t).offsetWidth},_setCurrentRow:function(n){(n==t.Grid.actions.Filtering||n==t.Grid.actions.Sorting||n==t.Grid.actions.Delete||n==t.Grid.actions.Save||n==t.Grid.actions.Cancel||n==t.Grid.actions.Paging)&&(this.model.selectedRow=-1)},refreshGridContent:function(n){n&&this.templateRefresh();var i={};i.requestType=t.Grid.actions.Refresh,this._processBindings(i)},templateRefresh:function(){this.addInitTemplate(),(this.model.edit.allowEditing||this.model.edit.allowAdding)&&this.addEditingTemplate(),(this.model.edit.allowEditing||this.model.edit.allowAdding)&&this.model.edit.editMode=="dialog"&&this.addDialogEditingTemplate(),(this.model.edit.allowEditing||this.model.edit.allowAdding)&&this.model.edit.editMode=="dialogTemplate"&&this.addExternalDialogEditingTemplate(),this.model.allowGrouping&&this.addGroupingTemplate(),this.model.detailTemplate!=null&&this.addDetailTemplate()},hideColumns:function(t){var i,u=0,f={},r;if(n.isArray(t))for(i=0;i<t.length;i++)r=n.inArray(t[i],this._visibleColumns),r!=-1&&(this._hiddenColumns.push(t[i]),this._visibleColumns.splice(r,1));else r=n.inArray(t,this._visibleColumns),r!=-1&&(this._hiddenColumns.push(t),this._visibleColumns.splice(r,1));for(i=0;i<this.model.columns.length;i++)if(n.inArray(this.model.columns[i].headerText,this._hiddenColumns)!=-1&&(this.model.columns[i].visible=!1,u++),this._hiddenColumns.length==u)break;this.templateRefresh(),f.requestType="refresh",this.sendDataRenderingRequest(f),this._hideHeaderColumn(this._hiddenColumns)},showColumns:function(t){var i,u=0,f={},r;if(n.isArray(t))for(i=0;i<t.length;i++)r=n.inArray(t[i],this._hiddenColumns),r!=-1&&(this._hiddenColumns.splice(r,1),this._visibleColumns.push(t[i]));else r=n.inArray(t,this._hiddenColumns),r!=-1&&(this._hiddenColumns.splice(r,1),this._visibleColumns.push(t));for(i=0;i<this.model.columns.length;i++)if(n.inArray(this.model.columns[i].headerText,this._visibleColumns)!=-1&&(this.model.columns[i].visible=!0,u++),this._visibleColumns.length==u)break;this.templateRefresh(),f.requestType="refresh",this.sendDataRenderingRequest(f),this._showHeaderColumn(this._visibleColumns)},clearSorting:function(){var t=this;this.model.sortSettings.sortedColumns=n.grep(this.model.sortSettings.sortedColumns,function(i){return n.inArray(i.field,t.model.groupSettings.groupedColumns)!=-1?!0:!1}),this._$prevSElementTarget=null,this._$curSElementTarget=null,this.refreshGridContent()},getBrowserDetails:function(){var n=navigator.userAgent.match(/(firefox|chrome|opera|msie|safari)\s?\/?(\d+(.\d+)*)/i);return{browser:n[1].toLowerCase(),version:n[2]}},getFieldNameByHeaderText:function(n){return t.isNullOrUndefined(this._fieldColumnNames[n])?null:this._fieldColumnNames[n]},getVisibleColumnNames:function(){return this._visibleColumns},getHiddenColumnNames:function(){return this._hiddenColumns},getHeaderTextByFieldName:function(n){return t.isNullOrUndefined(this._headerColumnNames[n])?null:this._headerColumnNames[n]},expandAll:function(){for(var i=this.element.find(".recordpluscollapse"),t=0;t<i.length;t++)this.expandCollapse(n(i[t]))},collapseAll:function(){for(var i=this.element.find(".recordplusexpand"),t=0;t<i.length;t++)this.expandCollapse(n(i[t]))},cleanUpSelection:function(i){if(this.model.selectedRow!=-1){var r=n(this.getGridRows()),i;t.isNullOrUndefined(i)?r.find(".rowcell, .detailrowcollapse, .detailrowexpand").removeClass("selectionbackground"):(n(r[i].cells).removeClass("selectionbackground"),i=n.inArray(i,this._selectedRowsIndexes),i!=-1&&this._selectedRowsIndexes.splice(i,1)),this._selectedRowsIndexes.length==0&&(this.model.selectedRow=-1)}return!0},_recalculateIndentWidth:function(){var r=this.getBrowserDetails(),n=this.getGridHeaderTable().find(".lastgrouptopleftcell").width(),t,u=n/30,i;u>1&&(t=30/u),this.getGridHeaderTable().find("colgroup").find("col").slice(0,this.model.groupSettings.groupedColumns.length).css("width",t+"px"),n=this.getGridHeaderTable().find(".lastgrouptopleftcell").width(),n>30?(this.getGridContentTable().find("table").filter(":not(.recordtable)").children("colgroup").find("col:first-child").css("width",n+"px"),i=this.getGridContentTable().find("colgroup").first().find("col").slice(0,this.model.groupSettings.groupedColumns.length),r.browser!="msie"?i.css("width",t+"px"):i.first().css("width",n/this.element.width()*100+"%")):r.browser!="msie"&&this.getGridContentTable().find("colgroup").first().find("col").slice(0,this.model.groupSettings.groupedColumns.length).css("width",t+"px")},setWidthToColumns:function(){var r=this.getGridContentTable().children("colgroup").find("col"),u=this.getGridHeaderTable().children("colgroup").find("col"),o=this.element.width(),s,e,h,c,l,i,f;for(this.model.groupSettings.groupedColumns.length&&(s=this.getBrowserDetails(),s.browser=="msie"&&parseInt(s.version,10)>8&&r.first().css("width",3e3/o+"%")),e=this.model.columns.length,r.length>e&&r.splice(0,r.length-e),u.length>e&&u.splice(0,u.length-e),i=0;i<u.length;i++)t.isNullOrUndefined(this._columnsWidthCollection[i])?this.model.allowScrolling&&(h=(o/this.model.columns.length).toFixed(2)+"px",r.eq(i).css("width",h),u.eq(i).css("width",h),this._columnsWidthCollection[i]=(o/this.model.columns.length).toFixed(2)):(r.eq(i).width(this._columnsWidthCollection[i]),u.eq(i).width(this._columnsWidthCollection[i]));if(this.model.isEdit&&(f=r.clone(),c=n("#"+this._id+"EditForm").find("colgroup"),c.empty().append(f),this.model.detailTemplate!=null&&c.prepend(this._getIndentCol())),this.model.groupSettings.groupedColumns.length)for(l=this.getGridContentTable().find(".recordtable").children("colgroup"),i=0;i<l.length;i++)f=r.clone(),this.model.detailTemplate!=null&&f.splice(0,0,this._getIndentCol()[0]),l.eq(i).empty().append(f)},expandCollapse:function(i){var s,r,f,e,o,u;if(i.prop("tagName")=="DIV"&&(i.parent().hasClass("recordplusexpand")||i.parent().hasClass("recordpluscollapse")||i.parent().hasClass("detailrowcollapse")||i.parent().hasClass("detailrowexpand"))&&(i=i.parent()),i.hasClass("recordplusexpand")&&this.model.groupSettings.groupedColumns.length)s=i.index(),r=i.closest("tr").next(),r.hide(),i.removeClass("recordplusexpand").addClass("recordpluscollapse");else if(i.hasClass("recordpluscollapse")&&this.model.groupSettings.groupedColumns.length){var s=i.index(),r=i.closest("tr").next(),f=[],e=r;for(n(e[0].cells[s]).hasClass("indentcell")&&e.children(".indentcell").length==i.parent().children(".indentcell").length+1&&(e.show(),o=e.children(".recordplusexpand"),o!=null&&o.length>0&&f.push(o)),i.removeClass("recordpluscollapse").addClass("recordplusexpand"),u=0;u<f.length;u++)f[u].removeClass("recordplusexpand").addClass("recordpluscollapse"),this.expandCollapse(f[u])}else if(i.hasClass("detailrowexpand")){var s=i.index(),c=i.closest("tr").index()-i.closest("tr").prevAll("tr.detailrow").length,r=i.closest("tr").next();this._trigger("detailCollapse",{masterRow:i.closest("tr"),detailRow:r,masterData:this._currentJsonData[c]}),r.hide(),i.removeClass("detailrowexpand").addClass("detailrowcollapse")}else if(i.hasClass("detailrowcollapse")){var s=i.index(),c=i.closest("tr").index()-i.closest("tr").prevAll("tr.detailrow").length,l=i.closest("tr").next();if(l.hasClass("detailrow"))r=l;else{var h=t.buildTag("tr.detailrow","",{display:"none"},{}),a=t.buildTag("td.detailindentcell"),v=t.buildTag("td.detailcell","",{},{colspan:this.model.columns.length});n(h).append(a),n(h).append(v.append(n(this.model.detailTemplate).render(this._currentJsonData[c]))),n(i.closest("tr")).after(h),this._trigger("detailData",{templateDetail:h}),r=h}for(this._trigger("detailExpand",{masterRow:i.closest("tr"),detailRow:r,masterData:this._currentJsonData[c]}),f=[],e=r,n(e[0].cells[s]).hasClass("detailindentcell")&&(e.show(),o=e.children(".detailrowexpand"),o!=null&&o.length>0&&f.push(o)),i.removeClass("detailrowcollapse").addClass("detailrowexpand"),u=0;u<f.length;u++)f[u].removeClass("detailrowexpand").addClass("detailrowcollapse"),this.expandCollapse(f[u])}},getSelectedRecords:function(){for(var t=[],n=0;n<this._selectedRowsIndexes.length;n++)this._selectedRowsIndexes[n]!=-1&&t.push(this._currentJsonData[this._selectedRowsIndexes[n]]);return t},selectRows:function(r,u){var f=n(this.getGridRows()),s={},e,o;if(this.model.selectedRow!=-1&&(s={currentRowIndex:this.model.selectedRow,currrentRow:f.eq(this.model.selectedRow),currentData:this.model.currentViewData[this.model.selectedRow]}),!this._trigger("rowSelecting",s)){if((this.model.edit.allowEditing||this.model.edit.allowAdding)&&this.model.isEdit&&this.model.autoSaveOnRowSelection){if(this.sendSaveRequest())return;f=n(this.getGridRows())}if(t.isNullOrUndefined(u)||t.isNullOrUndefined(r)){r=t.isNullOrUndefined(r)?u:r;switch(this.model.selectionType){case t.Grid.selectionType.Multiple:if(this._multiSelectCtrlRequest){e=n.inArray(r,this._selectedRowsIndexes),e!=-1&&this.cleanUpSelection(r)&&this._selectedRowsIndexes.splice(e,0),e==-1&&(this._selectedRowsIndexes.push(r),n(f[r]).find(".rowcell, .detailrowcollapse, .detailrowexpand").addClass("selectionbackground"));break}case t.Grid.selectionType.Single:this.cleanUpSelection(),this._selectedRowsIndexes=[],this._selectedRowsIndexes.push(r),n(f[r]).find(".rowcell, .detailrowcollapse, .detailrowexpand").addClass("selectionbackground")}}else{for(this.cleanUpSelection(),this._selectedRowsIndexes=[],rows=r-u<0?f.slice(r,u+1):f.slice(u,r+1),o=0;o<rows.length;o++)this._selectedRowsIndexes.push(rows[o].rowIndex);n(rows).find(".rowcell, .detailrowcollapse, .detailrowexpand").addClass("selectionbackground")}this._previousIndex=this._selectedRowsIndexes.length?r:i,this.model.selectedRow=r,this._trigger("rowSelected",{currentRowIndex:this.model.selectedRow,currrentRow:f.eq(this.model.selectedRow),currentData:this.model.currentViewData[this.model.selectedRow]}),this._multiSelectCtrlRequest=!1}},getColumnByHeaderText:function(n){for(var t=0;t<this.model.columns.length;t++)if(this.model.columns[t].headerText==n)break;return t==this.model.columns.length?null:this.model.columns[t]},getColumnByField:function(n){for(var t=0;t<this.model.columns.length;t++)if(this.model.columns[t].field==n)break;return t==this.model.columns.length?null:this.model.columns[t]},getColumnByIndex:function(n){return n<this.model.columns.length?this.model.columns[n]:null},getColumnIndexByField:function(n){for(var t=0;t<this.model.columns.length;t++)if(this.model.columns[t].field==n)break;return t},getColumnFieldNames:function(){for(var t=[],n=0;n<this.model.columns.length;n++)this.model.columns[n].field&&t.push(this.model.columns[n].field);return t},setValidation:function(){n("#"+this._id+"EditForm").validate({errorClass:"field-validation-error",errorElement:"span",errorPlacement:function(n,t){n.appendTo(t.closest("td"))}});for(var i=0;i<this.model.columns.length;i++)t.isNullOrUndefined(this.model.columns[i].validationRules)||this.setValidationToField(this.model.columns[i].field,this.model.columns[i].validationRules)},setValidationToField:function(i,r){var f=n("#"+this._id+i).length>0?n("#"+this._id+i):n("#"+i),u;f.rules("add",r),u=n("#"+this._id+"EditForm").validate(),t.isNullOrUndefined(r.required)||(u.settings.messages[i]={},u.settings.messages[i].required=this.getColumnByField(i).headerText+" is required")},_columnToSelect:function(){for(var i=[],n=0;n<this.model.columns.length;n++)this.model.columns[n].columnEditType===t.Grid.editingType.DropdownEdit&&t.isNullOrUndefined(this.model.columns[n].dropdownData)&&i.push(this.model.columns[n].field);return i.length?t.Query().select(i):t.Query()},_ensureDataSource:function(i){var u,c,f,e,o,s,l,r,h;if(this.model.dataSource!=null||this.model.dataSource instanceof t.DataManager){if(this.model.query.requiresCount(),u=this.model.query,this.model.dataSource instanceof t.DataManager||(this.model.currentViewData=this.model.dataSource),!(this.model.dataSource instanceof t.DataManager)&&(this.model.edit.allowEditing||this.model.edit.allowAdding)&&(!t.isNullOrUndefined(this._cModifiedData)||!t.isNullOrUndefined(this._cAddedRecord))){if(t.isNullOrUndefined(this._cAddedRecord)){for(f=0;f<this._primaryKeys.length;f++)u=u.where(this._primaryKeys[f],t.FilterOperators.equal,this._primaryKeyValues[f]);c=this._dataManager.executeLocal(u),n.extend(this.model.dataSource[n.inArray(c.result[0],this.model.dataSource)],this._cModifiedData),this._cModifiedData=null}else this.model.dataSource.unshift(this._cAddedRecord),this._cAddedRecord=null;u.queries=[],this.model.isEdit=!1}if(this.model.edit.allowDeleting&&!t.isNullOrUndefined(this._cDeleteData)&&(f=n.inArray(this._cDeleteData[0],this.model.dataSource),this.model.dataSource.splice(f,1)),this.model.sortSettings.sortedColumns.length)for(r=this.model.sortSettings.sortedColumns.length-1;r>=0;r--)u.sortBy(this.model.sortSettings.sortedColumns[r].field,this.model.sortSettings.sortedColumns[r].direction);if(this.model.allowSearching&&this._searchString.length&&(u.search(this._searchString,this.getColumnFieldNames(),t.FilterOperators.contains,!0),this.model.pageSettings.currentPage=1),this.model.allowFiltering&&this._filterCollection.length){for(o=this._filterCollection[0],e=t.Predicate(o.columnName,o.operator,o.value,!o.matchcase),r=1;r<this._filterCollection.length;r++)e=e[this._filterCollection[r].predicate](this._filterCollection[r].columnName,this._filterCollection[r].operator,this._filterCollection[r].value,!this._filterCollection[r].matchcase);u.where(e),this.model.dataSource instanceof t.DataManager?t.isNullOrUndefined(i)||i.requestType!=t.Grid.actions.Filtering||(this.model.pageSettings.currentPage=1):(this._filteredRecordsCount=this._dataManager.executeLocal(u).count,s=this._filteredRecordsCount%this.model.pageSettings.pageSize==0?this._filteredRecordsCount/this.model.pageSettings.pageSize:parseInt(this._filteredRecordsCount/this.model.pageSettings.pageSize,10)+1,(this.model.pageSettings.currentPage>s||this._filteredRecordsCount!=0&&this.model.pageSettings.currentPage==0)&&(this.model.pageSettings.currentPage=s)),this.model.allowSummary&&this.model.summaryRows.length>0&&(l=new t.Query,this._filteredRecords=this._dataManager.executeLocal(l.where(e)))}if(this.model.allowPaging&&(this.model.pageSettings.currentPage==0&&(this.model.pageSettings.currentPage=this._prevPageNo),u.page(this.model.pageSettings.currentPage,this.model.pageSettings.pageSize)),this.model.allowGrouping)for(r=0;r<this.model.groupSettings.groupedColumns.length;r++)u.group(this.model.groupSettings.groupedColumns[r]);this.model.dataSource instanceof t.DataManager||(h=this._dataManager.executeLocal(u),this.model.currentViewData=h.result,this._totalRecordsCount=this.model.dataSource.length,this._searchCount=this._searchString.length?h.count:null)}},sendDataRenderingRequest:function(i){var b,a,v,y,k,c,h,e,l,d,r,u,it,s,o,p,w,tt,f;if(this.model.currentViewData.length)switch(i.requestType){case t.Grid.actions.Refresh:case t.Grid.actions.Paging:case t.Grid.actions.Sorting:case t.Grid.actions.Filtering:case t.Grid.actions.Save:case t.Grid.actions.Cancel:case t.Grid.actions.Delete:case t.Grid.actions.Search:case t.Grid.actions.Reorder:if(this.model.groupSettings.groupedColumns.length==0){r=document.createElement("div"),this.getGridContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup()),this.model.detailTemplate!=null&&this.getGridContentTable().find("colgroup").first().prepend(this._getIndentCol()),r.innerHTML=["<table>",n.render[this._id+"_JSONTemplate"](this.model.currentViewData),"<\/table>"].join(""),this.getGridContentTable().get(0).replaceChild(this.model.rowTemplate!=null?r.firstChild.lastChild:r.firstChild.firstChild,this.getGridContentTable().get(0).lastChild),this._currentJsonData=this.model.currentViewData,this._gridRows=this.getGridContentTable().get(0).rows,this._eventBindings();break}case t.Grid.actions.Grouping:if(this.model.groupSettings.groupedColumns.length&&this.model.currentViewData){for(this._currentJsonData=[],b=this.getGridContentTable().children("tbody"),b.empty(),r=document.createElement("div"),this.model.groupSettings.groupedColumnShow||(this._hideHeaderColumn(this.model.groupSettings.groupedColumns,!0),this.getGridContentTable().children("colgroup").replaceWith(this.getGridHeaderTable().find("colgroup").clone())),this._isReorder=i.requestType=="reorder"?!0:!1,a=this.getGridContentTable().children("colgroup").find("col"),v=a.length-this.model.columns.length,this.model.detailTemplate!=null&&v--,a.length>this.model.columns.length&&this.getGridContentTable().children("colgroup").find("col:lt("+v+")").remove(),this.getGridContentTable().find("colgroup").first().replaceWith(this._getMetaColGroup()),f=0;f<this.model.groupSettings.groupedColumns.length;f++)this.getGridContentTable().children("colgroup").prepend(this._getIndentCol());r.innerHTML=["<table>",n.render[this._id+"_GroupingTemplate"](this.model.currentViewData,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join(""),this.getGridContentTable().get(0).replaceChild(r.firstChild.firstChild,this.getGridContentTable().get(0).lastChild),this._groupingAction(),this._recalculateIndentWidth(),y=this.getBrowserDetails(),this.model.allowScrolling&&y.browser=="msie"&&parseInt(y.version,10)>8&&(this.getGridContentTable().width(this.getGridHeaderTable().width()),this.getGridContentTable().children("colgroup").find("col").first().css("width",(this.getGridHeaderTable().find("colgroup").find("col").first().width()/this.getGridContentTable().width()*100).toFixed(2)+"%")),this._gridRows=this.getGridContentTable().get(0).rows,this._eventBindings(),this._gridRows=this.getGridContentTable().find(".recordtable").find("tbody").find("tr").toArray()}break;case t.Grid.actions.BeginEdit:for(k=t.DataManager(this._currentJsonData),c=new t.Query,h=0;h<this._primaryKeys.length;h++)c=c.where(this._primaryKeys[h],t.FilterOperators.equal,this._primaryKeyValues[h]);if(this._currentData=k.executeLocal(c),r=document.createElement("div"),e=n(r),this.model.edit.editMode=="dialog"||this.model.edit.editMode=="dialogTemplate")e.addClass("editedrow"),r.innerHTML=this.model.edit.editMode=="dialog"?n.render[this._id+"_JSONDialogEditingTemplate"](this._currentData):n.render[this._id+"_JSONdialogTemplateMode"](this._currentData),n("#"+this._id+"_dialogEdit").html(n(r)),u={},u.cssClass=this.model.cssClass,u.rtl=this.model.rtl,u.width=280,u.resizable=!1,u.contentContainer="#"+this._id,u.modal=!0,u.allowKeyboardNavigation=!1,u.title=this._getLocalizedLabels("EditFormTitle")+this._currentData[0][this._primaryKeys[0]],n("#"+this._id+"_dialogEdit").ejDialog(u),n("#"+this._id+"_dialogEdit").ejDialog("open");else{for(r.innerHTML=["<table>",n.render[this._id+"_JSONEditingTemplate"](this._currentData,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join(""),e.find("td").first().addClass("editcell"),l=e.find("select.field"),f=0;f<l.length;f++)l.eq(f).val(this._currentData[0][l[f].name]);this.model.groupSettings.groupedColumns.length>=2&&(d=i.currentTr.find("td.indentcell"),e.find("tr").first().prepend(d));var g=e.find("tr").first(),nt=0,o=this.model.groupSettings.groupedColumnShow?0:this.model.groupSettings.groupedColumns.length;this.model.detailTemplate!=null&&(nt++,e.find(".editcell").find("tr").prepend(i.currentTr.find("[class*='detailrow']"))),e.find(".editcell").get(0).colSpan=this.model.columns.length-this._hiddenColumns.length-o+nt,i.currentTr.hasClass("alt_row")&&g.addClass("alt_row"),i.currentTr.empty().replaceWith(g.addClass("editedrow")),this._refreshUnboundTemplate(n("#"+this._id+"EditForm")),this._gridRows=this.getGridContentTable().find("td.rowcell").closest("tr").toArray()}break;case t.Grid.actions.Add:if(r=document.createElement("div"),this.model.edit.editMode=="dialog"||this.model.edit.editMode=="dialogTemplate")n(r).addClass("addedrow"),r.innerHTML=this.model.edit.editMode=="dialog"?n.render[this._id+"_JSONDialogEditingTemplate"](i.data):n.render[this._id+"_JSONdialogTemplateMode"](i.data),n("#"+this._id+"_dialogEdit").html(n(r)),u={},u.cssClass=this.model.cssClass,u.modal=!0,u.width=280,u.resizable=!1,u.contentContainer="#"+this._id,u.modal=!0,u.rtl=this.model.rtl,u.allowKeyboardNavigation=!1,u.title="Add New Record",n("#"+this._id+"_dialogEdit").ejDialog(u),n("#"+this._id+"_dialogEdit").ejDialog("open");else{if(r.innerHTML=["<table>",n.render[this._id+"_JSONEditingTemplate"](i.data,{groupedColumns:this.model.groupSettings.groupedColumns}),"<\/table>"].join(""),n(r).find("td").first().addClass("editcell").end().find("input.field").val(""),it=n(r).find(".editcell").get(0),this.getGridContentTable().find("tbody").first().prepend(n(r).find("tr").first().addClass("addedrow")),s=n("#"+this._id+"EditForm").closest("tr.addedrow"),o=this.model.groupSettings.groupedColumnShow?0:this.model.groupSettings.groupedColumns.length,this.model.groupSettings.groupedColumns.length){for(f=0;f<this.model.groupSettings.groupedColumns.length;f++)f==0?s.prepend(t.buildTag("td.indentcell")):s.find("tr").prepend(t.buildTag("td.indentcell"));this.model.groupSettings.groupedColumns.length>=2?s.find("td.editcell").prop("colspan",this.model.columns.length+(this.model.groupSettings.groupedColumns.length-1)-this._hiddenColumns.length-o):s.find("td.editcell").prop("colspan",this.model.columns.length-this._hiddenColumns.length-o)}else s.find("td.editcell").prop("colspan",this.model.columns.length-this._hiddenColumns.length-o);this._refreshUnboundTemplate(n("#"+this._id+"EditForm")),this._gridRows=this.getGridContentTable().find("td.rowcell").closest("tr").toArray()}break;case t.Grid.actions.Ungrouping:if(p=this.element.children(".gridheader"),w=p.find(".filterbar").find("th").find("input"),p.find("div").first().empty().append(this._renderGridHeader().find("table")),this.model.allowFiltering&&this.model.filterSettings.filterType=="filterbar")for(this._renderFiltering(),tt=this.element.children(".gridheader").find(".filterbar").find("th").find("input"),f=0;f<w.length;f++)tt.eq(f).val(w.eq(f).val());this.model.groupSettings.groupedColumnShow||this._hideHeaderColumn(this.model.groupSettings.groupedColumns,!0),this.element.find(".gridcontent").children("div").first().empty().append(this._renderGridContent().find("table").first())}else this.getGridContentTable().find("tbody").empty().append(this._getEmptyTbody());this._completeAction(i)},_hideHeaderColumn:function(t,i){for(var o=this.getGridHeaderTable().find("thead"),h=o.find(".headercell"),c=o.find(".filterbar").find(".filterbarcell"),r=this.getGridHeaderTable().find("colgroup").find("col"),f,e,s,u=0;u<t.length;u++)f=i?this.getColumnByField(t[u]):this.getColumnByHeaderText(t[u]),e=n.inArray(f,this.model.columns),s=h.eq(e).addClass("hide").index(),c.eq(s).addClass("hide"),r.length>this.model.columns.length&&(r=r.slice(r.length-this.model.columns.length)),r.eq(e).css("display","none")},_showHeaderColumn:function(t,i){for(var e=this.getGridHeaderTable().find("thead"),s=e.find(".headercell"),h=e.find(".filterbar").find(".filterbarcell"),c=this.getGridHeaderTable().find("colgroup").find("col"),u,f,o,r=0;r<t.length;r++)u=i?this.getColumnByField(t[r]):this.getColumnByHeaderText(t[r]),f=n.inArray(u,this.model.columns),o=s.eq(f).removeClass("hide").index(),h.eq(o).removeClass("hide"),c.eq(f).css("display","")},_groupingAction:function(){var t=this.getGridHeaderTable().find("thead").find(".columnheader").find(".grouptopleftcell"),r=this.getGridHeaderTable().find("colgroup").find("col"),i=t.length,n;for(i&&(this.getGridHeaderTable().find("colgroup").replaceWith(this._getMetaColGroup()),this.model.detailTemplate!=null&&this.getGridHeaderTable().find("colgroup").prepend(this._getIndentCol()),t.remove(),this.getGridHeaderTable().find("thead").find(".filterbar").find(".filterbarcell:lt("+i+")").remove()),this.setWidthToColumns(),n=0;n<this.model.groupSettings.groupedColumns.length;n++)this.getGridHeaderTable().find("colgroup").prepend(this._getIndentCol()),this.getGridHeaderTable().find("thead").find(".columnheader").prepend(this._getGroupTopLeftCell()),this.getGridHeaderTable().find("thead").find(".filterbar").prepend(this._getEmptyFilterBarCell());this.getGridHeaderTable().find("thead").find("th.grouptopleftcell").last().addClass("lastgrouptopleftcell")},_completeAction:function(i){var f,e,o,s,u,r;if(this.model.isEdit=!1,t.Grid.actions.Grouping!=i.requestType||!t.isNullOrUndefined(i.columnName)){if(this.model.groupSettings.groupedColumns.length==0&&this.setWidthToColumns(),t.Grid.actions.Sorting==i.requestType&&this.model.allowSorting||t.Grid.actions.Refresh==i.requestType){for(this._multiSortRequest||this.getGridHeaderTable().find(".columnheader").find(".headercelldiv").find(".ascending,.descending").remove(),r=0;r<this.model.sortSettings.sortedColumns.length;r++)this._addSortElementToColumn(this.model.sortSettings.sortedColumns[r].field,this.model.sortSettings.sortedColumns[r].direction);this.model.groupSettings.groupedColumns.length&&this._$curSElementTarget!=null&&(f=this._checkEinGroupDrop(n.trim(this._$curSElementTarget.text())),t.isNullOrUndefined(f)||f.find(".ascending,.descending").removeClass().addClass(i.columnSortDirection)),this._refreshGridPager(),this._multiSortRequest=!1}else if((t.Grid.actions.Delete==i.requestType||t.Grid.actions.Save==i.requestType||t.Grid.actions.Search==i.requestType)&&this.model.allowPaging)this._filterCollection.length?this.getGridPager().ejPager({totalRecordsCount:this._searchCount==null?this._filteredRecordsCount:this._searchCount}):this.getGridPager().ejPager({totalRecordsCount:this._searchCount==null?this._totalRecordsCount:this._searchCount});else if(t.Grid.actions.Filtering==i.requestType){if(this._refreshGridPager(),this.model.filterSettings.filterType=="menu"){this._closeFilterDlg();var c=this.getColumnByField(this._$curFieldName),l=n.inArray(c,this.model.columns),a=this,h=!1;n.each(this._filterCollection,function(n,t){if(t.columnName==a._$curFieldName)return h=!0,!1}),e=this.getGridHeaderTable().find("thead").find(".headercell").eq(l).find(".filtericon"),h?e.addClass("filteredicon"):e.removeClass("filteredicon")}}else if(t.Grid.actions.BeginEdit==i.requestType||t.Grid.actions.Add==i.requestType){if(o=n("#"+this._id+"EditForm"),this.model.isEdit=!0,this.setWidthToColumns(),t.Grid.actions.Add==i.requestType)for(o.find(".field:disabled").not(".identity").removeAttr("disabled"),r=0;r<this.model.groupSettings.groupedColumns.length-1;r++)o.find("colgroup").prepend(this._getIndentCol());(this._tdsOffsetWidth.length==0||this.model.groupSettings.groupedColumns.length)&&this._setoffsetWidth(),this._refreshEditForm(),n.isFunction(n.validator)&&this.setValidation()}else if(t.Grid.actions.Grouping==i.requestType){if(u=this.element.children(".groupdroparea"),this.model.groupSettings.groupedColumns.length&&u.find(".grid-icon").length==0&&u.empty(),this._initialRender)for(r=0;r<this.model.groupSettings.groupedColumns.length;r++)this._addColumnToGroupDrop(this.model.groupSettings.groupedColumns[r]);else this._addColumnToGroupDrop(i.columnName);for(this.getGridHeaderTable().find(".columnheader").find(".headercelldiv").find(".ascending,.descending").remove(),r=0;r<this.model.sortSettings.sortedColumns.length;r++)this._addSortElementToColumn(this.model.sortSettings.sortedColumns[r].field,this.model.sortSettings.sortedColumns[r].direction);s=this.getBrowserDetails(),this.model.allowScrolling&&s.browser=="msie"&&parseInt(s.version,10)>8&&this.getGridContentTable().width(this._calculateWidth()),this._initialRender||this._groupHeaderCelldrag(),this.model.allowScrolling&&this.getGridContentTable().parent().scrollLeft(this.getGridHeaderTable().parent().scrollLeft()-1),this.element.children(".cloneproperties").remove()}else if(t.Grid.actions.Ungrouping==i.requestType){for(u=this.element.children(".groupdroparea"),this._removeColumnFromDrop(i.columnName),this.getGridHeaderTable().find(".columnheader").find(".headercelldiv").find(".ascending,.descending").remove(),r=0;r<this.model.sortSettings.sortedColumns.length;r++)this._addSortElementToColumn(this.model.sortSettings.sortedColumns[r].field,this.model.sortSettings.sortedColumns[r].direction);this.model.groupSettings.groupedColumns.length==0&&(u.html(this.model.enableEffects?"":this._getLocalizedLabels("GroupDropArea")),this.model.groupSettings.showAnimateButton&&u.append(t.buildTag("div.animatebutton").addClass(this.model.enableEffects?"animatebuttondown":"animatebuttonup")),u.css("height","auto")),this._headerCellgDragDrop(),this.model.allowScrolling&&this.getGridContentTable().parent().scrollLeft(this.getGridHeaderTable().parent().scrollLeft()+10),this.element.children(".cloneproperties").remove()}this.model.toolBar.allowToolBar&&this.refreshToolBar(),this.model.allowSummary&&this.model.summaryRows.length>0&&this._createSummaryRows(n("#"+this._id+"_summaryTable")),this._setCurrentRow(i.requestType),i.requestType==(t.Grid.actions.Grouping||t.Grid.actions.Ungrouping||t.Grid.actions.Add||t.Grid.actions.Edit||t.Grid.actions.Filtering)&&(this.model.allowScrolling&&this.element.find(".gridcontent").first().ejScroller("refresh").ejScroller("isVScroll")?this.element.find(".gridheader").addClass("scrollcss"):this.element.find(".gridheader").removeClass("scrollcss")),this._trigger("actionComplete",i)}},_refreshGridPager:function(){if(this.getGridPager()!=null){var i=this.getGridPager().ejPager("model"),n={};n.currentPage=this.model.pageSettings.currentPage,this._filteredRecordsCount==0&&this.model.currentViewData.length==0&&(t.isNullOrUndefined(this._prevPageNo)||this._prevPageNo)?(n.currentPage=0,this._prevPageNo=i.currentPage,this.model.pageSettings.currentPage=0):i.currentPage==0&&(t.isNullOrUndefined(this._prevPageNo)||this._prevPageNo)&&(n.currentPage=this._prevPageNo),n.totalRecordsCount=this._filterCollection.length==0?this._searchCount==null?this._totalRecordsCount:this._searchCount:this._filteredRecordsCount,this.getGridPager().ejPager("option",n)}},_refreshUnboundTemplate:function(n){var o,f,e,r,i,s,h,u;if(this._isUnboundColumn)for(o=0,f=0;f<this.model.columns.length;f++)if(this.model.columns[f].isUnBound)for(e=n.find(".unboundcell."+this.model.columns[f].headerText.replace(/\s+/g,"")).find(".unboundcelldiv"),r=this.model.columns[f].commands,i=0;i<r.length;i++)s=t.isNullOrUndefined(r[i].buttonOptions.width)?"52":r[i].buttonOptions.width,h=t.isNullOrUndefined(r[i].buttonOptions.height)?"30":r[i].buttonOptions.height,r[i].buttonOptions.width=t.isNullOrUndefined(r[i].buttonOptions.width)?"52":r[i].buttonOptions.width,r[i].buttonOptions.height=t.isNullOrUndefined(r[i].buttonOptions.height)?"28":r[i].buttonOptions.height,r[i].buttonOptions.cssClass=this.model.cssClass,r[i].buttonOptions.rtl=this.model.rtl,u=e.find("."+r[i].type+"button"),n.closest(".editcell").length?r[i].type=="save"||r[i].type=="cancel"?u.show():(u.hasClass("deletebutton")&&u.hide(),u.hasClass("editbutton")&&u.hide()):r[i].type=="save"||r[i].type=="cancel"?u.hide():(u.hasClass("deletebutton")&&u.show(),u.hasClass("editbutton")&&u.show()),u.ejButton(r[i].buttonOptions);else continue},refreshToolBar:function(){var r=n("#"+this._id+"_toolbarItems"),i=r.find("li"),t;for(r.ejToolbar("enableItem",i),t=0;t<i.length;t++)switch(i[t].id){case this._id+"_add":case this._id+"_edit":case this._id+"_delete":this.model.isEdit&&(n(i[t]).hasClass("toolhover")&&n(i[t]).removeClass("toolhover"),this._disabledToolItems.push(i[t]));break;case this._id+"_update":case this._id+"_cancel":this.model.isEdit||(n(i[t]).hasClass("toolhover")&&n(i[t]).removeClass("toolhover"),this._disabledToolItems.push(i[t]))}r.ejToolbar("disableItem",this._disabledToolItems),this._disabledToolItems=n()},sendDeleteRequest:function(i){var s,r,h,e,f,u,o,c;if(this.model.edit.allowDeleting){if(this.model.selectedRow==-1&&t.isNullOrUndefined(i)){alert(this._getLocalizedLabels("DeleteOperationAlert"));return}for(t.isNullOrUndefined(i)&&(i=n(this.getGridRows()).eq(this.model.selectedRow)),this._primaryKeyValues=[],r=0;r<this._primaryKeys.length;r++)s=this.getColumnByField(this._primaryKeys[r]),r=n.inArray(s,this.model.columns),this._primaryKeyValues.push(i.find(".rowcell").eq(r).html());for(h=t.DataManager(this._currentJsonData),e=new t.Query,f=0;f<this._primaryKeys.length;f++)e=e.where(this._primaryKeys[f],t.FilterOperators.equal,this._primaryKeyValues[f]);if(currentData=h.executeLocal(e),u={},u.tr=i,u.data=currentData[0],u.requestType=t.Grid.actions.Delete,this._trigger("actionBegin",u))return!0;this._cDeleteData=currentData,this.model.dataSource instanceof t.DataManager?(o=this._dataManager.remove(this._primaryKeys[0],currentData[0][this._primaryKeys[0]]),c=this,o.done(function(){c._processBindings(u)}),o.fail(function(){})):this._processBindings(u),this._primaryKeyValues=[],this._cDeleteData=null}},sendEditingRequest:function(i){var f,r,u,e;if(this.model.edit.allowEditing){if(this.model.selectedRow==-1&&t.isNullOrUndefined(i)){alert(this._getLocalizedLabels("EditOperationAlert"));return}for(t.isNullOrUndefined(i)?(this._currentTrIndex=this.model.selectedRow,this._$currentTr=n(this.getGridRows()).eq(this.model.selectedRow)):(this._currentTrIndex=i.index(),this._$currentTr=i),r=0;r<this._primaryKeys.length;r++)f=this.getColumnByField(this._primaryKeys[r]),r=n.inArray(f,this.model.columns),this._primaryKeyValues.push(this._$currentTr.find(".rowcell").eq(r).html());if(u={currentTr:this._$currentTr,rowIndex:this._currentTrIndex,primaryKey:this._primaryKeys,primaryKeyValue:this._primaryKeyValues},e=this._trigger("beginEdit",u),e){this._primaryKeyValues=[];return}u.requestType=t.Grid.actions.BeginEdit,this._processBindings(u)}},sendAddRequest:function(){var t,i,u,r,f;if(this.model.edit.allowAdding){for(cloneData={},t=0;t<this.model.columns.length;t++)cloneData[this.model.columns[t].field]="";i={},i.data=cloneData,i.requestType="add",this.cleanUpSelection(),u=this._processBindings(i),u||(this.model.selectedRow=0),r=this.model.groupSettings.groupedColumns.length,r>1&&(f=this.getGridContentTable().find(".addedrow").find("table").find("colgroup").children(),n(f.slice(0,r-1)).css("width",this.getGridHeaderTable().find("colgroup").children()[0].style.width))}},sendSaveRequest:function(){var r,h,u,e,o,c,f,s,l,a;if(this.model.isEdit){if(!this.editFormValidate())return!0;for(obj={},r=document.getElementById(this._id+"EditForm"),h=this.model.edit.editMode=="dialog"||this.model.edit.editMode=="dialogTemplate"?n(r).closest("div"):n(r).closest("tr"),u=0;u<r.length;u++)h.hasClass("addedrow")&&n(r[u]).hasClass("identity")||(e=r[u].name,o=n(r[u]),e!=i&&(e==""&&(e=r[u].id.replace(this._id,"")),e!=""&&obj[e]==null&&(c=this.getColumnByField(e),f=r[u].value,n(r[u]).hasClass("e-datepicker")?(f=o.ejDatePicker("theDate"),o.ejDatePicker("destroy")):o.is(".e-numerictextbox")?f=o.ejNumericTextbox("getValue"):o.data("ejDropDownList")&&(f=o.ejDropDownList("getSelectedValue")),c==null?f=parseFloat(f):c.type=="number"&&f.length&&(f=parseFloat(f)),obj[e]=r[u].type!="checkbox"?f:n(r[u]).is(":checked"))));if(s={data:obj},s.requestType=t.Grid.actions.Save,this._trigger("actionBegin",s))return!0;h.hasClass("editedrow")?this._cModifiedData=obj:h.hasClass("addedrow")&&(this._cAddedRecord=obj),this.model.dataSource instanceof t.DataManager?(l=t.isNullOrUndefined(this._cModifiedData)?this._dataManager.insert(s.data):this._dataManager.update(this._primaryKeys[0],s.data),a=this,l.done(function(){a._processBindings(s)}),l.fail(function(){})):this._processBindings(s),this._cModifiedData=null,this._cAddedRecord=null,this._primaryKeyValues=[]}},sendGroupingRequest:function(i){var r,u,f;if(this.model.allowGrouping&&n.inArray(i,this._disabledGroupableColumns)==-1&&!t.isNullOrUndefined(this.getColumnByField(i))&&n.inArray(i,this.model.groupSettings.groupedColumns)==-1){for(this.model.groupSettings.groupedColumns.push(i),r=0;r<this.model.sortSettings.sortedColumns.length;r++)if(this.model.sortSettings.sortedColumns[r].field==i)break;this.model.sortSettings.sortedColumns.length==r&&this.model.sortSettings.sortedColumns.push({field:i,direction:t.sortOrder.Ascending}),u={},u.columnName=i,u.requestType=t.Grid.actions.Grouping,f=this._processBindings(u),f&&this.model.groupSettings.groupedColumns.pop(),this._primaryKeyValues=[]}},sendUngroupingRequest:function(i){var u,r,f;if(this.model.allowGrouping){if(n.inArray(i,this.model.groupSettings.groupedColumns)!=-1)this.model.groupSettings.groupedColumns.splice(n.inArray(i,this.model.groupSettings.groupedColumns),1);else return null;for(u={},r=0;r<this.model.sortSettings.sortedColumns.length;r++)if(this.model.sortSettings.sortedColumns[r].field==i){this.model.sortSettings.sortedColumns.splice(r,1);break}u.columnName=i,u.requestType=t.Grid.actions.Ungrouping,f=this._processBindings(u),f&&this.model.groupSettings.groupedColumns.push(i),this._primaryKeyValues=[]}},sendCancelRequest:function(){var i={};n("#"+this._id+"EditForm").find(".e-datepicker").ejDatePicker("destroy"),i.requestType=t.Grid.actions.Cancel,this._processBindings(i),this._primaryKeyValues=[],this._currentData=null},sendSearchRequest:function(n){var i={};i.requestType=t.Grid.actions.Search,i.keyValue=n,this._searchString=n,this._processBindings(i),this._primaryKeyValues=[]},sendSortingRequest:function(r,u){var f,o,e,s;if(this.model.allowSorting&&n.inArray(r,this._disabledSortableColumns)==-1&&r.length!=0){for(f={},this._multiSortRequest||(o=this,this.model.sortSettings.sortedColumns=n.grep(this.model.sortSettings.sortedColumns,function(t){return n.inArray(t.field,o.model.groupSettings.groupedColumns)!=-1?!0:!1})),f.requestType=t.Grid.actions.Sorting,f.columnName=r,this._cSortedColumn=this.getFieldNameByHeaderText(r),this._cSortedDirection=f.columnSortDirection=u===i?t.sortOrder.Ascending:u,e=0;e<this.model.sortSettings.sortedColumns.length;e++)if(this.model.sortSettings.sortedColumns[e].field==this._cSortedColumn){this.model.sortSettings.sortedColumns.splice(e,1);break}this.model.sortSettings.sortedColumns.push({field:this._cSortedColumn,direction:this._cSortedDirection}),s=this._processBindings(f),s&&(this._cSortedDirection=this._cSortedColumn=null),this._primaryKeyValues=[]}},sendPagingRequest:function(n){if(this.model.allowPaging){var i={};i.requestType=t.Grid.actions.Paging,this.model.pageSettings.currentPage=n,i.endIndex=this.model.pageSettings.currentPage*this.model.pageSettings.pageSize>this._totalRecordsCount?this._totalRecordsCount:this.model.pageSettings.currentPage*this.model.pageSettings.pageSize,i.startIndex=this.model.pageSettings.currentPage*this.model.pageSettings.pageSize-this.model.pageSettings.pageSize,i.currentPage=n,this.getGridPager().ejPager("refreshPager"),this._processBindings(i),this._primaryKeyValues=[]}},_setDateFilters:function(t){var u=new Date(t.value.setDate(t.value.getDate()-1)),f=new Date(t.value.setDate(t.value.getDate()+2)),i=n.extend({},t),r=n.extend({},t);i.value=u,r.value=f,t.operator=="equal"?(i.operator=">",i.predicate="and",r.operator="<",r.predicate="and"):(i.operator="<=",i.predicate="or",r.operator=">=",r.predicate="or"),this._filterCollection.push(i),this._filterCollection.push(r)},sendFilteringRequest:function(i,r,u,f,e){var s,l,p,h,o,w,c,a,y;if(this.model.allowFiltering){for(s={},s.requestType=t.Grid.actions.Filtering,n.isArray(r)||(r=n.makeArray(r)),n.isArray(u)||(u=n.makeArray(u)),l=!1,p=this._filterCollection,h=0;h<r.length;h++){if(o={columnName:i,operator:r[h],value:u[h],matchcase:e,predicate:f},this.model.filterSettings.filterType=="filterbar"&&(this._$colType=this._currentFilterColumn.type),this._filterCollection.length==0&&o.value!=="")this._$colType=="date"&&(r=="equal"||r=="notequal")?this._setDateFilters(o):this._filterCollection.push(o);else{if(w=this,!l){var b=t.DataManager(this._filterCollection),k=(new t.Query).where("columnName",t.FilterOperators.equal,o.columnName),v=b.executeLocal(k);for(c=0;c<v.length;c++)a=n.inArray(v[c],this._filterCollection),a!=-1&&this._filterCollection.splice(a,1)}o.value!==""&&(this._$colType=="date"&&(r=="equal"||r=="notequal")?this._setDateFilters(o):this._filterCollection.push(o))}l=!0}s.filterCollection=this._filterCollection,s.currentFilteringColumn=i,y=this._processBindings(s),y&&(this._filterCollection.reverse().splice(0,r.length),this._filterCollection.reverse())}},sendReorderingRequest:function(n,t){var i=this.model.columns.indexOf(this.getColumnByField(n)),r=this.model.columns.indexOf(this.getColumnByField(t));this.set_dropColumn(i,r)},collapseGroupDropArea:function(){$groupDropArea=this.element.find(".groupdroparea").first(),proxy=this,this.model.groupSettings.groupedColumns.length==0&&this.model.enableEffects&&$groupDropArea.animate({height:"10px"},200,function(){proxy.model.groupSettings.groupedColumns.length==0&&(n(this).html("").append(t.buildTag("div.animatebutton animatebuttondown")),n(this).dequeue().css("height","auto"))})},expandGroupDropArea:function(){$groupDropArea=this.element.find(".groupdroparea").first(),proxy=this,this.model.groupSettings.groupedColumns.length==0&&proxy.model.enableEffects&&$groupDropArea.animate({height:"30px"},150,function(){proxy.model.groupSettings.groupedColumns.length==0&&$groupDropArea.html(proxy._getLocalizedLabels("GroupDropArea")).append(t.buildTag("div.animatebutton animatebuttonup")),$groupDropArea.dequeue().css("height","30px")})},_wireEvents:function(){var n=this.model.allowFiltering&&this.model.filterSettings.filterType=="menu";(this.model.allowSelection||n)&&this._on(this.element,"click",this._clickHandler),this._on(this.element,"click",".gridheader",this._mouseClickHandler),this._enableEditingEvents(),this._enableRowHover(),this._on(this.element,"click",".gridcontent .unboundcelldiv",this._unboundClickHandler),this._enableGroupingEvents(),this._enableFilterEvents(),this.model.allowKeyboardNavigation&&(this.element[0].tabIndex=0,this.element[0].accessKey="e",this._on(this.element,"keyup",this._keyDownHandler)),this._on(this.element,"mousedown",".gridheader",this._headerMouseDown),this._on(this.element,"mouseenter mouseleave",".groupdroparea,.groupheadercell",this._dropAreaHover),this._on(this.element,"mouseover mousemove mouseleave",".gridheader",this._headerHover),this.model.allowResizing&&(this._on(this.element,"mousemove",this._mouseMove),this._on(this.element,"mouseup",this._mouseUp))},_enableGroupingEvents:function(){this.model.allowGrouping&&(this._on(this.element,"click",".groupdroparea,.groupheadercell",this._groupHeaderCellClick),this._on(this.element,"mousedown",".groupheadercell",function(){return!1}))},_enableEditingEvents:function(){if(this.model.edit.allowEditing||this.model.edit.allowAdding){if(this.model.edit.allowEditing&&this.model.editOnDoubleClick&&this._on(this.element,"dblclick",".gridcontent",this._editdblClickHandler),this.model.edit.editMode=="dialog"||this.model.edit.editMode=="dialogTemplate"){this._on(n("#"+this._id+"_dialogEdit"),"click keypress","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel",this._buttonClick);n(this.element).on("click",".e-icon",n.proxy(this._buttonClick,this))}}else this._off(this.element,"dblclick",".gridcontent"),this._off(n("#"+this._id+"_dialogEdit"),"click","#EditDialog_"+this._id+"_Save ,#EditDialog_"+this._id+"_Cancel"),n(this.element).off("click",".e-icon")},_enableRowHover:function(){this.model.rowHover?this._on(this.element,"mouseenter mouseleave",".gridcontent tr td",this._rowHover):this._off(this.element,"mouseenter mouseleave",".gridcontent tr td")},_enableFilterEvents:function(){this.model.allowFiltering&&(this.model.filterSettings.filterType=="menu"?this._off(n(document),"click")._on(n(document),"click",this._docClickHandler):(this._off(this.element,"keyup",".filterbar input")._on(this.element,"keyup",".filterbar input",this._filterBarHandler),this.model.filterSettings.showFilterBarMessage&&this._off(this.element,"mouseover",".e-grid-filterstatusbar,.e-grid-filterstatusbarbottom")._on(this.element,"mouseover",".e-grid-filterstatusbar,.e-grid-filterstatusbarbottom",this._stausBarHoverHandler)))},_dropAreaHover:function(t){var i=n(t.target),r=this;return t.type=="mouseenter"?(this._dragActive?i.hasClass("groupdroparea")&&i.addClass("groupdropareahover"):i.removeClass("groupdropareahover"),i.hasClass("groupheadercell")&&this.model.groupSettings.showUngroupButton&&i.find(".ungroupbutton").show(150)):t.type=="mouseleave"&&(i.hasClass("groupdroparea")&&(i.find(".ungroupbutton").hide(150),i.removeClass("groupdropareahover")),i.hasClass("groupheadercell")&&this.model.groupSettings.showUngroupButton&&i.find(".ungroupbutton").hide(150)),!1},_mouseUp:function(n){this.model.allowResizing&&this._resizer._mouseUp(n)},_mouseMove:function(n){this.model.allowResizing&&this._resizer._mouseMove(n)},_headerMouseDown:function(t){if(this.model.allowResizing&&this._resizer._mouseDown(t),n(t.target).hasClass("headercelldiv")&&!n(t.target).parent().hasClass("grouptopleftcell")||n(t.target).hasClass("headercell")){var i=n(t.target).hasClass("headercelldiv")?n(t.target).parent():n(t.target);this.model.headerEffects&&i.addClass("headercellactive")}},_headerHover:function(t){var i=n(t.target);t.type=="mouseover"||t.type=="mousemove"?(this.model.allowResizing&&this._resizer._mouseHover(t),this.model.headerEffects&&!this._dragActive&&(i.hasClass("headercelldiv")&&!i.parent().hasClass("grouptopleftcell")||i.hasClass("headercell"))&&(i.hasClass("headercelldiv")&&(i=i.parent()),this.getGridHeaderTable().find(".columnheader").find(".headercell-hover").removeClass("headercell-hover"),i.addClass("headercell-hover"))):this.model.headerEffects&&this.getGridHeaderTable().find(".columnheader").find(".headercell-hover").removeClass("headercell-hover")},_groupHeaderCellClick:function(t){var i=n(t.target),r,u;return i.hasClass("ungroupbutton")?(r=n.trim(i.parent().text()),u=this.getFieldNameByHeaderText(r),this.sendUngroupingRequest(u)):i.hasClass("togglegroupbutton")?(r=n.trim(i.parent().text()),u=this.getFieldNameByHeaderText(r),i.hasClass("toggleungroup")&&this.sendUngroupingRequest(u)):i.hasClass("animatebutton")&&(this.model.enableEffects?(this.expandGroupDropArea(),this.model.enableEffects=!1):(this.model.enableEffects=!0,this.collapseGroupDropArea())),!1},_rowHover:function(t){var i,r,u;if(this.model.rowHover)return(i=n(t.target),r=n(this.getGridRows()),i.hasClass("rowcell")&&i.closest("#"+this._id+"EditForm").length||!i.hasClass("rowcell"))?void 0:(t.type!="mouseenter"||this._dragActive?r.removeClass("enablerowhover"):(r.removeClass("enablerowhover"),u=r.index(i.parent()),u!=-1&&i.parent().addClass("enablerowhover")),!1)},_unboundClickHandler:function(t){var i=n(t.target),r,u;i.hasClass("unboundcelldiv")||(this.model.allowSelection&&this.selectRows(n(this.getGridRows()).index(i.closest("tr"))),n.isFunction(n.fn.ejDatePicker)&&n("#"+this._id+"EditForm").find(".e-datepicker").ejDatePicker("hideDatePicker"),i.hasClass("editbutton")?(r=n(this.getGridRows()).index(i.closest("tr")),this.model.isEdit&&this.sendCancelRequest(),u=n(this.getGridRows()[r]),this.sendEditingRequest(u)):i.hasClass("deletebutton")?this.sendDeleteRequest(i.closest("tr")):i.hasClass("savebutton")?this.sendSaveRequest():i.hasClass("cancelbutton")&&this.sendCancelRequest())},_docClickHandler:function(t){var i=this.getBrowserDetails();this._$colType&&n(t.target).find(".e-grid-core.dlgcontainer").length>1&&(i.browser=="msie"?t.target.tagName!="BODY"&&this._closeFilterDlg():this._closeFilterDlg())},_closeFilterDlg:function(){n("#"+this._id+"_"+this._$colType+"Dlg").ejDialog("close"),this._$fDlgIsOpen=!1},_clickHandler:function(i){var r=n(i.target);if(!r.closest("#"+this._id+"EditForm").length){if(r.hasClass("rowcell")||r.parent().hasClass("rowcell")){if(!this.model.allowSelection)return;this.model.selectionType==t.Grid.selectionType.Multiple&&(i.ctrlKey&&(this._multiSelectCtrlRequest=!0),i.shiftKey&&(this._multiSelectShiftRequest=!0,this.selectRows(this._previousIndex,n(this.getGridRows()).index(r.closest("tr"))))),this._multiSelectShiftRequest||this.selectRows(n(this.getGridRows()).index(r.closest("tr"))),this._multiSelectShiftRequest=!1}this.expandCollapse(r),this.model.allowFiltering&&this.model.filterSettings.filterType=="menu"&&r.closest(".dlgcontainer").length!=1&&this._closeFilterDlg()}},_editdblClickHandler:function(t){var i=n(t.target);return i.hasClass("rowcell")&&(this.model.isEdit||(this._$currentTr=i.closest("tr"),this.sendEditingRequest(this._$currentTr))),!1},_stausBarHoverHandler:function(t){var f=this.element.width(),i=n(t.target),e=i.width(),u=0,r=this.element.find(".e-grid-filterstatusbar, .e-grid-filterstatusbarbottom");return i.hasClass("status-left")||i.hasClass("status-left")?(r.addClass("status-right"),r.removeClass("status-left"),u=f-e-2):(i.hasClass("status-right")||i.parent().hasClass("status-right"))&&(r.addClass("status-left"),r.removeClass("status-right")),r.css({"margin-left":u+"px"}),!1},_keyPressed:function(t,i,r){var f,u,o,e,s;if(!this.model.allowKeyboardNavigation||i.tagName=="INPUT"&&r.code!=13&&r.code!=27&&r.code!=9||String.fromCharCode(r.code).toLowerCase()==this.element[0].accessKey.toLowerCase()||(this.model.edit.editMode=="dialog"||this.model.edit.editMode=="dialogTemplate")&&n(i).closest("#"+this._id+"EditForm").length)return!0;this.getGridPager()!=null&&(f=this.getGridPager().ejPager("model"),u=f.currentPage),o=!1;switch(t){case"insertRecord":this._toolbarOperation(this._id+"_add");break;case"saveRequest":this._toolbarOperation(this._id+"_update");break;case"cancelRequest":this._toolbarOperation(this._id+"_cancel");break;case"deleteRecord":this._toolbarOperation(this._id+"_delete");break;case"editRecord":this._toolbarOperation(this._id+"_edit");break;case"totalGroupCollapse":this.collapseAll();break;case"totalGroupExpand":this.expandAll();break;case"selectedGroupExpand":this._$currentTr=n(this.getGridRows()).eq(this.model.selectedRow),e=this._$currentTr.parents("tr").first().prev().find(".recordpluscollapse"),this.expandCollapse(e);break;case"selectedGroupCollapse":this._$currentTr=n(this.getGridRows()).eq(this.model.selectedRow),e=this._$currentTr.parents("tr").first().prev().find(".recordplusexpand"),this.expandCollapse(e);break;case"firstRowSelection":this.selectRows(0);break;case"lastRowSelection":this.selectRows(n(this.getGridRows()).length-1);break;case"upArrow":this.selectRows(this.model.selectedRow==0?0:this.model.selectedRow-1);break;case"downArrow":s=n(this.getGridRows()).length-1,this.selectRows(this.model.selectedRow==s?s:this.model.selectedRow+1);break;case"nextPage":this.getGridPager()!=null&&(u=u+1);break;case"previousPage":this.getGridPager()!=null&&(u=u-1);break;case"lastPage":this.getGridPager()!=null&&(u=f.totalPages);break;case"firstPage":this.getGridPager()!=null&&(u=1);break;case"nextPager":this.getGridPager()!=null&&(u=Math.ceil(f.currentPage/f.pageCount)*f.pageCount+1);break;case"previousPager":this.getGridPager()!=null&&(u=(Math.floor(f.currentPage/f.pageCount)-1)*f.pageCount+1);break;default:o=!0}return this.getGridPager()!=null&&f.currentPage!==u&&this.getGridPager().ejPager("goToPage",u),o},_mouseClickHandler:function(i){var r,f,s,u,e,o;if(n(i.target).is(".ascending, .descending")&&(i.target=i.target.parentNode),r=n(i.target),this._$fDlgIsOpen&&this.model.allowFiltering&&this.model.filterSettings.filterType=="menu"&&(n.fx.off=!0,n("#"+this._id+"_"+this._$prevColType+"Dlg").ejDialog("close"),n.fx.off=!1),this.getGridHeaderTable().find(".columnheader").find(".headercellactive").removeClass("headercellactive"),r.hasClass("headercelldiv")){if(!this.model.allowSorting)return;u=n.trim(r.text()),f=t.sortOrder.Ascending,this._$prevSElementTarget=this._$curSElementTarget,this._$curSElementTarget=r,f=r.find("span").hasClass("ascending")?t.sortOrder.Descending:t.sortOrder.Ascending,this.model.allowMultiSorting&&i.ctrlKey&&(this._multiSortRequest=!0),this.sendSortingRequest(u,f)}else if(r.hasClass("togglegroupbutton"))u=n.trim(r.parent().text()),s=this.getFieldNameByHeaderText(u),r.hasClass("togglegroup")&&this.sendGroupingRequest(s),r.hasClass("toggleungroup")&&this.sendUngroupingRequest(s);else if((r.hasClass("filtericon")||r.hasClass("filteredicon"))&&(u=n.trim(r.parent().text()),this._$prevFieldName=this._$curFieldName,this.model.allowFiltering)){e=this,n.each(this.model.columns,function(n,t){t.headerText==u&&(e._$colType=t.type,e._$curFieldName=t.field,e._$colFormat=t.format)}),o="#"+this._id+"_"+this._$colType+"Dlg",this._$colType=="string"?n("#"+this._id+"_acString").ejAutocomplete({fields:{text:e._$curFieldName,id:this._getIdField()}}):this._$colType=="date"&&(this._$colFormat=this._$colFormat.replace("{0:","").replace("}",""),n(o).find(".e-datewidget input").ejDatePicker({dateFormat:this._$colFormat.replace("{0:","").replace("}","")})),this._setFilterFieldValues(o);var h=n(document).width(),c=250,l=i.clientX;h-i.clientX<=c&&(l=h-c),n(o).ejDialog({position:{X:l,Y:r.parent().offset().top+32}}).ejDialog("open"),this._$colType=="number"&&n(o).find(".e-numerictextbox").ejNumericTextbox({width:"230px"}),this._$prevColType=this._$colType,this._$fDlgIsOpen=!0}return!1},_setFilterFieldValues:function(t){var i="",r=this;this._$curFieldName!=this._$prevFieldName&&(n.each(this._filterCollection,function(n,t){if(t.columnName==r._$curFieldName)return i=t.value,!1}),this._$colType=="boolean"?i&&i!=""?n(t).find(".value input").attr("checked",!0):n(t).find(".value input").attr("checked",!1):n(t).find(".value input").val(i))},_getIdField:function(){var t;return n.each(this.model.columns,function(n,i){if(i.key)return t=i.field,!1}),t},_gPagerClickHandler:function(n){if(this._prevPageNo!=n.currentPage)return this.model.masterObject.sendPagingRequest(n.currentPage),!1},_toolBarClick:function(t){var f=n(this.itemsContainer).closest(".e-grid"),u=f.ejGrid("instance"),r=f.attr("id");if((t.event!=i||t.target.tagName!="INPUT"||t.currentTarget.id!=r+"_search")&&(n.isFunction(n.fn.ejDatePicker)&&n("#"+r+"EditForm").find(".e-datepicker").ejDatePicker("hideDatePicker"),!f.ejGrid("instance")._trigger("toolBarClick",t))){switch(t.currentTarget.id){case r+"_add":u._toolbarOperation(r+"_add");break;case r+"_edit":u._toolbarOperation(r+"_edit");break;case r+"_delete":u._toolbarOperation(r+"_delete");break;case r+"_update":u._toolbarOperation(r+"_update");break;case r+"_cancel":u._toolbarOperation(r+"_cancel");break;case r+"_search":u._toolbarOperation(r+"_search",n(t.currentTarget).find("input").val())}return!1}},_toolbarOperation:function(n,t){var i=this.element,r=i.attr("id");switch(n){case r+"_add":i.ejGrid("sendAddRequest");break;case r+"_edit":i.ejGrid("sendEditingRequest");break;case r+"_delete":i.ejGrid("sendDeleteRequest");break;case r+"_update":i.ejGrid("sendSaveRequest");break;case r+"_cancel":i.ejGrid("sendCancelRequest");break;case r+"_search":i.ejGrid("sendSearchRequest",t)}return!1},_filterBarHandler:function(t){var f=t.keyCode,i,r,u;if((this.model.filterSettings.filterBarMode=="immediate"||f==13)&&f!=9){if(i=n(t.target),this.filterStatusMsg="",r=i.closest("th").index()-this.model.groupSettings.groupedColumns.length,this.model.detailTemplate!=null&&r--,u=this.getColumnByIndex(r),u==null)return;if(this._currentFilterColumn=u,this._currentFilterColumn!=this._oldFilterColumn&&(this.filterValueOldLength=0),this._currentFilterbarValue=i.val(),this.filterValueCurrentLength=this._currentFilterbarValue.length,(this.filterValueCurrentLength==0&&this.filterValueOldLength==0||this._currentFilterbarValue==this.OldfilterValue)&&this._currentFilterColumn==this._oldFilterColumn){this._showFilterMsg();return}if(this._skipFilterProcess=this._checkForSkipInput(),this._skipFilterProcess)if(this._currentFilterColumn.type=="string")this.filterStatusMsg="Invalid Filter Data",this._showFilterMsg();else{this._skipFilterProcess=!1,this._showFilterMsg();return}else this._processFilter()}},editFormValidate:function(){return n.isFunction(n.validator)?n("#"+this._id+"EditForm").validate().form():!0},_checkEinHeader:function(t){for(var r=this.element.children(".gridheader").find("thead").find(".columnheader").find(".headercell"),i=0;i<r.length;i++)if(n.trim(r.eq(i).text())==t)return r.eq(i);return null},_checkEinGroupDrop:function(t){for(var r=this.element.children(".groupdroparea").find(".grid-icon"),i=0;i<r.length;i++)if(n.trim(r.eq(i).text())==t)return r.eq(i);return null},_addColumnToGroupDrop:function(n){var i=t.buildTag("div.grid-icon groupheadercell"),o=this.element.find(".groupdroparea").first(),r=t.buildTag("div"),s=this.getColumnByField(n),u,f;i.append(r.html(s.headerText)),u=this._checkEinHeader(s.headerText),this.model.groupSettings.toggleGrouping&&(r.append(this._getToggleButton().addClass("toggleungroup")),u.find(".headercelldiv").find(".togglegroupbutton").remove().end().append(this._getToggleButton().addClass("toggleungroup"))),f="ascending",u.find(".ascending,.descending").length&&(f=u.find(".ascending,.descending").hasClass("ascending")?"ascending":"descending"),r.append(this._createSortElement().addClass(f)),this.model.groupSettings.showUngroupButton&&r.append(t.buildTag("span.ungroupbutton"," ",{},{title:"Click here to ungroup"})),o.append(i).css("height","auto");var h=i.offset().left,e=i.clone().css("position","absolute"),c=this;i.css("visibility","hidden"),o.append(e).dequeue(),e.css({left:h+150}).animate({left:h},150,function(){i.css("visibility","visible"),e.remove()})},_removeColumnFromDrop:function(t){for(var u=this.getHeaderTextByFieldName(t),e=this,f=this.element.children(".groupdroparea"),r=f.css("height","30px").find(".grid-icon"),i=0;i<r.length;i++)n.trim(r.eq(i).text())==u&&(this.model.groupSettings.groupedColumns.length==0?this.collapseGroupDropArea():r.eq(i).remove())},_addSortElementToColumn:function(t,i){var u=this.getColumnByField(t),f=n.inArray(u,this.model.columns),r=this.getGridHeaderTable().find("thead").find(".headercell").not(".detailheadercell").eq(f).find(".headercelldiv");r.find(".ascending,.descending").remove(),r.append(this._createSortElement().addClass(i))},_removeSortElementFromColumn:function(t){var i=this.getColumnByField(t),r=n.inArray(i,this.model.columns),u=this.getGridHeaderTable().find("thead").find(".headercell").not(".detailheadercell").eq(r).find(".headercelldiv");u.find(".ascending,.descending").remove()},_refreshEditForm:function(){for(var p=document.getElementById(this._id+"EditForm"),c=!1,l=n(p).find("input,select"),r,f,h,o,u,s,v,y,e=0;e<l.length;e++)if(r=l.eq(e),!r.closest("td").hasClass("unboundcell")){if(f=this._tdsOffsetWidth[e]*(80/100),r.hasClass("numerictextbox")){var o=f>0?r.width()>f?f:r.width():1,u={},a=r.val();u.width=o,u.height=28,u.rtl=this.model.rtl,u.showSpinButton=!0,u.cssClass=this.model.cssClass,a.length&&(u.value=parseFloat(a)),h=this.getColumnByField(r.prop("name")),t.isNullOrUndefined(h.numericEditParams)||n.extend(u,h.numericEditParams),r.ejNumericTextbox(u),r.prop("name",r.prop("name").replace(this._id,""))}else if(r.hasClass("datepicker"))o=f>0?r.width()>f?f:r.width():1,u={},u.width=o,u.height=28,u.rtl=this.model.rtl,u.cssClass=this.model.cssClass,u.displayDefaultDate=!0,u.showDateIcon=!1,r.val().length&&(u.defaultDate=new Date(r.val())),s=this.getColumnByField(r.prop("name")),s.format!==i&&s.format.length>0&&(v=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),y=v.exec(s.format),u.dateFormat=y[2]),r.ejDatePicker(u);else if(r.hasClass("dropdownlist"))r.ejDropDownList({width:f+"px",rtl:this.model.rtl}),r.ejDropDownList("selectItemByValue",r.val());else switch(r.prop("tagName")){case"INPUT":r.attr("type")!="checkbox"?r.width(f>0?f:r.width()).height(28).css("text-align",r.attr("name")!=null?this.getColumnByField(r.attr("name")).textAlign:"center"):r.width(f>0?r.width()>f?f:r.width():1);break;case"SELECT":r.width(f>0?f:r.width()).height(28)}r.is(":disabled")||c||r.is(":hidden")||(this._focusElements(r.closest("td")),c=!0)}},_focusElements:function(n){if(n.length){var t=n.children();t[0].tagName.toLowerCase()=="select"||t[0].tagName.toLowerCase()=="input"?(t.focus().select(),t[0].focus()):t.find("input").focus().select()}},_processFilter:function(){this._alreadyFilterProcessed?(this._stopTimer(),this._startTimer()):(this._alreadyFilterProcessed=!0,this._startTimer())},_startTimer:function(){var n=this;this._timer=window.setTimeout(function(){n._onTimerTick()},1500)},_stopTimer:function(){this._oldFilterColumn=this._currentFilterColumn,this.filterValueOldLength=this.filterValueCurrentLength,this._timer!=null&&window.clearTimeout(this._timer)},_onTimerTick:function(){this.OldfilterValue=this._currentFilterbarValue,this._findPredicate(),this._skipFilterProcess?this.filterStatusMsg="Invalid Filter Data":this.sendFilteringRequest(this._currentFilterColumn.field,this._operator,this._currentFilterbarValue,this._predicate,this._currentFilterColumn.type=="string"?!1:!0),this._showFilterMsg(),this._stopTimer()},_findPredicate:function(){var e=this._currentFilterbarValue.replace(/ && /i," and ").replace(" || "," or "),r=e.split(" "),i;if(this._predicate="and",r.length!=0)if(n.isFunction(t.Predicate[r[1]])){this._skipFilterProcess=!1,this._predicate=r[1];var u=e.split(" "+r[1]+" "),o=[],f=[];for(i=0;i<u.length;i++)this._validateFilterValue(u[i]),o.push(this._operator),this._currentFilterColumn.type=="number"?f.push(this._currentFilterbarValue):this._currentFilterColumn.type=="string"&&f.push(u[i]);this._currentFilterbarValue=f,this._operator=o}else this._validateFilterValue(n.trim(this._currentFilterbarValue));else this._validateFilterValue(n.trim(this._currentFilterbarValue))},_validateFilterValue:function(n){var r,i,u;switch(this._currentFilterColumn.type){case"number":for(this._operator=t.FilterOperators.equal,r=[">","<","=","!"],i=0;i<n.length;i++)if(jQuery.inArray(n[i],r)!=-1)break;i!=n.length&&(this._getOperator(n.substring(i)),i!=0&&(this._currentFilterbarValue=n.substring(0,i))),this._currentFilterbarValue=this._currentFilterbarValue!=""&&n.length>1?parseFloat(this._currentFilterbarValue):n.length>1?parseFloat(n):n;break;case"date":this._operator=t.FilterOperators.equal,this._getOperator(n),u=this._currentFilterColumn.format==""?Globalize.culture().calendar.patterns.d:this._currentFilterColumn.format.split(":")[1].replace("}",""),this._currentFilterbarValue!=""&&(this._currentFilterbarValue=Globalize.parseDate(this._currentFilterbarValue,u));break;case"string":this._operator=t.FilterOperators.startsWith;break;case"boolean":this._currentFilterbarValue.toLowerCase()=="true"||this._currentFilterbarValue=="1"?this._currentFilterbarValue=!0:(this._currentFilterbarValue.toLowerCase()=="false"||this._currentFilterbarValue=="0")&&(this._currentFilterbarValue=!1),this._operator=t.FilterOperators.equal;break;default:this._operator=t.FilterOperators.equal}},_getOperator:function(n){n.charAt(0)=="="&&(this._operator=t.FilterOperators.equal,this._currentFilterbarValue=n.substring(1)),(t.data.operatorSymbols[n.charAt(0)]!==i||t.data.operatorSymbols[n.slice(0,2)]!==i)&&(this._operator=t.data.operatorSymbols[n.charAt(0)],this._currentFilterbarValue=n.substring(1),this._operator===i&&(this._operator=t.data.operatorSymbols[n.slice(0,2)],this._currentFilterbarValue=n.substring(2))),(this._operator==t.FilterOperators.lessThan||this._operator==t.FilterOperators.greaterThan)&&this._currentFilterbarValue.charAt(0)=="="&&(this._operator=this._operator+"orequal",this._currentFilterbarValue=this._currentFilterbarValue.substring(1))},_checkForSkipInput:function(){var u=!1,e=this,f,r;if(this._currentFilterColumn.type=="number"&&(t.data.operatorSymbols[this._currentFilterbarValue]!==i||n.inArray(this._currentFilterbarValue,["="," ","!"])!=-1)&&(u=!0),this._currentFilterColumn.type=="string")for(f=[">","<","=","!"],r=0;r<this._currentFilterbarValue.length;r++)jQuery.inArray(this._currentFilterbarValue[r],f)!=-1&&(u=!0);return u},_showFilterMsg:function(){var t=jQuery.inArray(this._currentFilterColumn,this.filterColumnCollection);if(this._currentFilterbarValue!==""&&t==-1&&this.filterColumnCollection.push(this._currentFilterColumn),this._currentFilterbarValue==""&&t!=-1&&this.filterColumnCollection.splice(t,1),(!this._skipFilterProcess||this.filterColumnCollection.length>0)&&this.filterStatusMsg!="Invalid Filter Data")for(t=0;t<this.filterColumnCollection.length;t++)t>0&&(this.filterStatusMsg+=" && "),this.filterStatusMsg+=this.filterColumnCollection[t].headerText+": "+n("#"+this.filterColumnCollection[t].field+"_filterBarcell").val();this.$statusBarDiv.find(".msgdiv").html(this.filterStatusMsg),this.filterStatusMsg=="Invalid Filter Data"&&(t=jQuery.inArray(this._currentFilterColumn,this.filterColumnCollection),this.filterColumnCollection.splice(t,1)),this.filterStatusMsg="",this.filterColumnCollection.length==0&&this._currentFilterbarValue==""?this.$statusBarDiv.css({display:"none"}):this.$statusBarDiv.css({display:"block"})},formatting:function(t,i){var r,o,f,e,s,h,u;return t=t.replace(/%280/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">"),r=t,o=t.split("{0:"),s=t.split("}"),f=o[0],e=s[1],t.indexOf("{0:")!=-1?(h=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),u=h.exec(t),u!=null&&i!=null?f!=null&&e!=null?f+Globalize.format(i,u[2])+e:Globalize.format(i,u[2]):i!=null?i:""):this.data!=null&&this.data.Value==null?(n.each(this.data,function(n,t){r=r.replace(new RegExp("\\{"+n+"\\}","gm"),t)}),r):this.data.Value},_destroy:function(){this.element.empty().removeClass("e-grid-core e-grid "+this.model.cssClass)}}),t.Grid.localization={},t.Grid.localization["en-US"]={EmptyRecord:"No records to display",GroupDropArea:"Drag a column header here to group its column",DeleteOperationAlert:"No records selected for delete operation",EditOperationAlert:"No records selected for edit operation",SaveButton:"Save",CancelButton:"Cancel",EditFormTitle:"Details of ",Notactionkeyalert:"This Key-Combination is not avaiable",Keyconfigalerttext:"This Key-Combination has already been assigned to ",GroupCaptionFormat:"items"},t.Grid.filterBarMode={Immediate:"immediate",OnEnter:"onenter"},t.Grid.actions={Paging:"paging",Sorting:"sorting",Filtering:"filtering",BeginEdit:"beginedit",Save:"save",Add:"add",Delete:"delete",Cancel:"cancel",Grouping:"grouping",Ungrouping:"ungrouping",Refresh:"refresh",Reorder:"reorder"},t.Grid.toolBarItems={Add:"add",Edit:"edit",Delete:"delete",Update:"update",Cancel:"cancel",Search:"search"},t.Grid.editingType={StringEdit:"stringedit",BooleanEdit:"booleanedit",NumericEdit:"numericedit",DropdownEdit:"dropdownedit",DatePickerEdit:"datepicker"},t.Grid.unboundType={Edit:"edit",Save:"save",Delete:"delete",Cancel:"cancel"},t.Grid.selectionType={Single:"single",Multiple:"multiple"},t.Grid.editMode={Normal:"normal",Dialog:"dialog",DialogTemplate:"dialogTemplate"},t.Grid.filterType={Menu:"menu",FilterBar:"filterbar"},t.Grid.summaryType={Average:"average",Minimum:"minimum",Maximum:"maximum",Count:"count",Sum:"sum",TrueCount:"truecount",FalseCount:"falsecount",Custom:"custom"}})(jQuery,Syncfusion),gridResize.prototype={_mouseHover:function(n){var t;if(!this._$visualElement.is(":visible")&&($(n.target).is(".headercelldiv")&&(n.target=n.target.parentNode),t=$(n.target),t.hasClass("headercell"))){var u=n.target,i=u.getBoundingClientRect(),r=n.clientX,f=n.clientY,e=this.gridInstance.getGridHeaderTable().width()+this.gridInstance.element.children(".gridheader").find(".columnheader").offset().left;(r>=i.left+document.documentElement.scrollLeft+u.offsetWidth-5||r<=i.left+3)&&r<e&&r>=i.left&&f<=i.top+document.documentElement.scrollTop+n.target.offsetHeight?(t.parent().css("cursor","col-resize"),this._currentCell=u.cellIndex,this._allowStart=!0):(t.parent().css("cursor","pointer"),this._allowStart=!1,this._currentCell=-1)}},_start:function(n,t){var r=this.gridInstance.getGridHeaderTable().find(".columnheader")[0],f=r.cells,i,u;(this._currentCell!=-1&&this._currentCell<r.cells.length&&(i=f[this._currentCell]),typeof i!="undefined")&&(u=i.getBoundingClientRect(),this._tableY=u.top+parseInt(navigator.userAgent.indexOf("WebKit")!=-1?document.body.scrollTop:document.documentElement.scrollTop),this._allowStart?(this._$visualElement=$(document.createElement("div")),_height=this.gridInstance.element.find(".gridcontent").first().height()+this.gridInstance.element.find(".gridheader").height(),this._$visualElement.addClass("reSizeColbg").appendTo(this.gridInstance.element).css({height:_height+"px",cursor:"col-resize"}),this._$visualElement.css({left:n,top:this._tableY}),this._oldWidth=i.offsetWidth,this._orgX=n,this._orgY=t,this._extra=n-this._orgX,this._expand=!0):this._currentCell=-1)},_mouseMove:function(n){if(this._expand){var t=n.clientX,i=n.clientY;navigator.userAgent.indexOf("WebKit")!=-1&&(t=n.pageX,i=n.pageY),t+=document.documentElement.scrollLeft,n.preventDefault(),this._moveVisual(t)}else this._mouseHover(n)},_reSize:function(n){var c=this,t,i,u,o,f;if(this._initialTableWidth=this.gridInstance.getGridHeaderTable().parent().width(),this._getResizableCell(),i=this.gridInstance.getGridHeaderTable().find(".columnheader"),this._currentCell!=-1&&this._expand){this._expand=!1;var s=i[0].cells,h=s[this._currentCell],e=h.offsetWidth,r=n-this._orgX;parseInt(r)+parseInt(e)>this._colMinWidth&&(r!=0&&i.css("cursor","default"),this._resizeColumnUsingDiff(e,r),this.gridInstance._findColumnsWidth(),t=this.gridInstance.element.find(".gridcontent").first(),this.gridInstance.model.allowScrolling&&t.ejScroller("refresh"),u=this.gridInstance.getBrowserDetails(),u.browser=="msie"&&(o=this.gridInstance.getGridContentTable().width(),f=this.gridInstance._calculateWidth(),parseInt(u.version,10)>8&&this.gridInstance.model.groupSettings.groupedColumns.length&&(f>o?(this.gridInstance.getGridContentTable().width(f),this.gridInstance.getGridContentTable().children("colgroup").find("col").first().css("width",2e3/t.find("table").first().width()+"%")):(this.gridInstance.getGridContentTable().css("width","100%"),this.gridInstance._groupingAction(),this.gridInstance.getGridContentTable().children("colgroup").find("col").first().css("width",(this.gridInstance.getGridHeaderTable().find("colgroup").find("col").first().width()/t.find("table").first().width()*100).toFixed(2)+"%"))),this.gridInstance.getGridHeaderTable().parent().scrollLeft(t.find(".content").scrollLeft()-1)))}this._$visualElement.remove(),this._expand=!1,this._currentCell=-1,this._allowStart=!1},_resizeColumnUsingDiff:function(n,t){var h=this,i=parseInt(t)+parseInt(n),f,e,u,r;if(i>0&&t!=0){i<this._colMinWidth&&(i=this._colMinWidth);var t=i-n,o=this.gridInstance.getGridHeaderTable().find("colgroup").find("col").eq(this._currentCell),s=this.gridInstance.getGridContentTable().find("colgroup").first().find("col").eq(this._currentCell);if(o.width(i),this.gridInstance.model.isEdit&&(f=this.gridInstance.getGridContentTable().find(".editedrow,.addedrow").find("table").find("colgroup"),$(f[0].children[this._currentCell-this.gridInstance.model.groupSettings.groupedColumns.length]).width(i)),this.gridInstance.model.groupSettings.groupedColumns.length)for(e=this.gridInstance.getGridContentTable().find(".recordtable"),u=e.find("colgroup"),r=0;r<u.length;r++)$(u[r].children[this._currentCell-this.gridInstance.model.groupSettings.groupedColumns.length]).width(i);s.width(i),this.gridInstance.getGridHeaderTable().find(".columnheader").css("cursor","default")}},_mouseUp:function(n){if(this._expand){var t=n.clientX,i=n.clientY;navigator.userAgent.indexOf("WebKit")!=-1&&(t=n.pageX,i=n.pageY),t+=document.documentElement.scrollLeft,this._reSize(t,i)}},_getResizableCell:function(){for(var r=this.gridInstance.getGridHeaderTable().find(".columnheader")[0],t=r.cells,u=navigator.userAgent.indexOf("WebKit")!=-1?document.body.scrollLeft:document.documentElement.scrollLeft,i,n=0;n<t.length;n++)if(point=t[n].getBoundingClientRect(),i=point.left+u+5,i>this._orgX){this._currentCell=n-1;return}},_moveVisual:function(n){var t=this.gridInstance.getGridHeaderTable()[0].getBoundingClientRect();t.left+document.documentElement.scrollLeft+t.width<n||n<t.left+document.documentElement.scrollLeft?this._$visualElement.remove():this._currentCell!=-1&&this._$visualElement.css({left:n,top:this._tableY})},_mouseDown:function(n){if(this._allowStart&&this.gridInstance.getGridHeaderTable().find(".columnheader").css("cursor")=="col-resize"){var t=n.clientX,i=n.clientY;navigator.userAgent.indexOf("WebKit")!=-1&&(t=n.pageX,i=n.pageY),t+=document.documentElement.scrollLeft,n.button!=2&&this._start(t,i),n.preventDefault()}return!1}}